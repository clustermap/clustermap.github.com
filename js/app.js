define("HandlebarsHelpers",[],function(){return Handlebars.registerHelper("formatDate",function(e,t){return e?Date.parse(e).toString("d MMM yyyy"):t||""}),Handlebars.registerHelper("formatMoney",function(e){return(e||0).formatMoney()}),Handlebars.registerHelper("formatNumber",function(e,t,n,r){return(e||0).formatNumber(t,n,r)}),Handlebars.registerHelper("sector_icon",function(e){var t;return t=(_.find(e.tags,function(e){return e.type==="sector"})||{}).tag||"OTH","/img/sec_"+t+".png"}),Handlebars.registerHelper("stripes",function(e,t,n,r){var i,s,o,u;if((e!=null?e.length:void 0)>0){i="",s=0,u=e.length;while(s<u)o=e[s],o.stripeClass=s%2===0?t:n,i+=r.fn(o),s++;return i}return r.elseFn()}),Handlebars.registerHelper("higlighted_org",function(e){var t;return t=techcity.model.org_displaying(),t[e.id]?"highlighted":""}),Handlebars.registerHelper("groups",function(e,t,n,r,i){var s,o,u,a,f;o=0;if(e&&e.length>0){s="",u=0,f=e.length;while(u<f)a=e[u],o===0&&(s+=t),s+=i.fn(a),o+=1,o>r&&(s+=n,o=0),u++;return o>0&&(s+=n),s}return elseFn()}),Handlebars.registerHelper("tagsOfType",function(e,t,n){var r,i;return r="",i=_.filter(e,function(e){return e.type===t}),_.each(i,function(e){return r+=n.fn(e)}),r}),Handlebars.registerHelper("filtered",function(e,t,n,r,i){var s,o,u;return s="",o=_.filter(e,function(e){return e[n]===r}),u={},u[t]=o,o.length>0&&(s+=i.fn(u)),s})}),define("api",[],function(){var e,t,n,r;return t="scarypumpkin",e=function(e){var n,r;return e.cache=!0,e.beforeSend=function(e){return e.setRequestHeader("Cache-Control","max-age=600"),e.setRequestHeader("X-TechCityMap-ApiKey",t)},e.dataType="json",e.timeout=3e4,e.complete=function(){},r=$.Deferred(),n=$.ajax(e),n.done(function(e,t,n){return r.resolve(e.data)}),n.fail(function(e,t,n){return console.error(e,t,n,arguments)}),r},n=function(t,n){return e({url:t,data:n,dataType:"json"})},r=function(t,n){return e({url:t,data:n,type:"POST",dataType:"json"})},{get_company_by_id:function(e,t,r){var i,s;return i=n("/api/companies/"+e,null),s=n("/api/companies/"+e+"_egonet"),$.when(i,s).done(function(e,n){var r;return r=$.extend({},e,n),r.profile_image_url=r.profile_image_url||"/img/default_twitter_profile.png",t(r)})},search_org_by_name:function(e){return n("/api/companies/search?q="+e)},search_tags:function(e){return n("/api/tags/search?q="+e)}}}),define("charts",[],function(){return{rednder_revenue_overview:function(e){var t,n;return n=new Highcharts.Chart({chart:{renderTo:$("#revenue_overview .chart").get(0),type:"area",height:160},title:null,subtitle:null,legend:{enabled:!1},xAxis:{startOnTick:!0,categories:_.map(e.revenue_timeline,function(e){return Date.parse(e.accounts_date)}),labels:{formatter:function(){return Highcharts.dateFormat("%Y",this.value)}}},yAxis:{showFirstLabel:!1,title:null,labels:{formatter:function(){return"£"+Highcharts.numberFormat(this.value,0,",")}}},tooltip:{crosshairs:!0,formatter:function(){return"<div>Year "+this.x.getFullYear()+"</div><br/><div>"+"£"+Highcharts.numberFormat(this.y,0,",")+"</div>"},shared:!0},plotOptions:{area:{color:"#FE9900",lineWidth:5,fillOpacity:.5}},series:[{name:"Revenue",data:_.map(e.revenue_timeline,function(e){return e.revenue})}],credits:{enabled:!1}}),t=new Highcharts.Chart({chart:{renderTo:$("#employees_overview .chart").get(0),type:"area",height:150},title:null,subtitle:null,legend:{enabled:!1},xAxis:{startOnTick:!0,categories:_.map(e.revenue_timeline,function(e){return Date.parse(e.accounts_date)}),labels:{formatter:function(){return Highcharts.dateFormat("%Y",this.value)}}},yAxis:{showFirstLabel:!1,title:null,labels:{formatter:function(){return this.value}}},tooltip:{crosshairs:!0,formatter:function(){return"<div>Year "+this.x.getFullYear()+"</div><br/><div>"+this.y+"</div>"},shared:!0},plotOptions:{area:{color:"#AC2148",lineWidth:5,fillOpacity:.5}},series:[{name:"Employment",data:_.map(e.employee_count_timeline,function(e){return e.employee_count})}],credits:{enabled:!1}})}}}),define("force",["model"],function(e){var t,n;return $("image.node-img").live("click",function(){return techcitymap.sammy.context.redirect("#/company/"+$(this).attr("data-org").replace("_",""))}),n=function(t){var n;n=e.egonet_companies_rank();if(n==="influence")return 15+5*t.influence;if(n==="mentions")return 15+5*t.is_mentioned_rank;if(n==="tweets")return 15+5*t.tweet_rank},t=function(t){var n;n=e.egonet_network_rank();if(n==="follow")return t.r_c===0?"#EE3387":"#009900";if(n==="mention")return t.r_c===0?"#EE3387":"#009900";if(n==="hashtag")return"#FF34CE";if(n==="shares_directors_with")return"#FF0000"},{render_egonet:function(e,r){var i,s,o,u,a,f,l,c,h,p,d,v;return p=function(r){var i,s,o,u;return _.each(h,function(e){return e.added=!1}),u=_.reduce(r,function(e,t){return h[t.l]&&!h[t.l].added&&(h[t.l].added=!0,e.push(h[t.l])),h[t.r]&&!h[t.r].added&&(h[t.r].added=!0,e.push(h[t.r])),e},[]),u.length===0&&(u=[h[e]]),a.nodes(u),a.links(r),i=d3.select("#twitter_networks .chart g.edges").selectAll("line.link").data(r,function(e){return e.l+"-"+e.r+"-"+e.type}),i.enter().append("svg:line").attr("class","link").style("stroke-width",function(e){return""+(2+e.weight)}).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),i.exit().remove(),o=d3.select("#twitter_networks .chart g.nodes").selectAll("g.node").data(u,function(e){return e.id}),o.select("image").attr("height",function(e){return e.root?32:n(e)}).attr("width",function(e){return e.root?32:n(e)}),s=o.enter().append("svg:g").attr("class",function(e){return e.root?"node root":"node"}).call(a.drag),s.append("svg:image").attr("xlink:href",function(e){return e.profile_image_url}).attr("height",function(e){return e.root?32:n(e)}).attr("width",function(e){return e.root?32:n(e)}).attr("class","node-img").attr("data-org",function(e){return"_"+e.id}),s.append("svg:text").attr("dy",function(e){return e.root?24:n(e)}).attr("dx",function(e){return e.root?16:n(e)*.5}).attr("text-anchor","middle").text(function(e){return e.name}),o.exit().remove(),a.on("tick",function(){var e,r,i;return r=$("#twitter_networks .chart").width()/2,i=$("#twitter_networks .chart").height()/2,e=d3.select("#twitter_networks .chart g.edges").selectAll("line.link"),u=d3.select("#twitter_networks .chart g.nodes").selectAll("g.node"),e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("stroke",function(e){return t(e)}),u.attr("transform",function(e){var t;return t=e.root?16:n(e)/2,"translate("+(e.x-t)+","+(e.y-t)+")"})}),a.start()},o=d3.scale.category20(),a=d3.layout.force().linkStrength(.5).charge(-800).friction(.4).linkDistance(100).nodes([]).links([]),d=d3.select("#twitter_networks .chart").append("svg:svg"),d.append("svg:g").attr("class","edges"),d.append("svg:g").attr("class","nodes"),d.append("svg:defs").append("svg:marker").attr("id","Triangle").attr("viewBox","0 0 20 20").attr("refX","30").attr("refY","5").attr("markerUnits","userSpaceOnUse").attr("markerWidth","20").attr("markerHeight","20").attr("orient","auto").append("svg:path").attr("d","M 0 3 L 15 5 L 0 7 z").attr("stroke-width",1),v=$("#twitter_networks .egonet").width(),f=$("#twitter_networks .egonet").height(),d.attr("width",v).attr("height",f),a.size([v,f]),h=_.reduce(r.nodes,function(e,t){return e[t.id]=t,e},{}),h[e].fixed=!0,h[e].root=!0,h[e].x=v/2,h[e].y=f/2,u=_(r.edges.follows).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.weight=e.weight||.5,e.type="follows_edges",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),c=_(r.edges.is_mentioned_by).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="mentions_edges",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),l=_(r.edges.hashtag).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="hashtag_relations",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),i=_(r.edges.shares_directors_with).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="shares_directors_with",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),s=ko.dependentObservable(function(){if(this.egonet_network_rank()==="follow")return u;if(this.egonet_network_rank()==="mention")return c;if(this.egonet_network_rank()==="hashtag")return l;if(this.egonet_network_rank()==="shares_directors_with")return i},techcity.model),p(s()),s.subscribe(function(e){return p(e)}),techcity.model.egonet_companies_rank.subscribe(function(){return p(s())}),$("#relation_type").buttonset()},render_directors_network:function(e,r){var i,s,o,u,a,f,l,c;return s=d3.scale.category20(),o=d3.layout.force().linkStrength(.5).charge(-600).friction(.4).linkDistance(50).nodes([]).links([]),l=d3.select("#directors_network .chart").append("svg:svg"),l.append("svg:g").attr("class","edges"),l.append("svg:g").attr("class","nodes"),l.append("svg:defs").append("svg:marker").attr("id","Triangle").attr("viewBox","0 0 20 20").attr("refX","30").attr("refY","5").attr("markerUnits","userSpaceOnUse").attr("markerWidth","20").attr("markerHeight","20").attr("orient","auto").append("svg:path").attr("d","M 0 3 L 15 5 L 0 7 z").attr("stroke-width",1),c=$("#directors_network .egonet").width(),u=$("#directors_network .egonet").height(),l.attr("width",c).attr("height",u),o.size([u,u]),a=_.reduce(r.nodes,function(e,t){return e[t.id]=t,e},{}),a[e].fixed=!0,a[e].root=!0,a[e].x=c/2,a[e].y=u/2,i=_(r.edges.shares_directors_with).chain().map(function(e){return e.source=a[e.l],e.target=a[e.r],e.type="shares_directors_with",e}).filter(function(e){return a[e.l]&&a[e.r]}).value(),f=function(r){var i,s,u,f,l;return _.each(a,function(e){return e.added=!1}),l=_.reduce(r,function(e,t){return a[t.l]&&!a[t.l].added&&(a[t.l].added=!0,e.push(a[t.l])),a[t.r]&&!a[t.r].added&&(a[t.r].added=!0,e.push(a[t.r])),e},[]),l.length===0&&(l=[a[e]]),o.nodes(l),o.links(r),s=d3.select("#directors_network .chart g.edges").selectAll("line.link").data(r,function(e){return e.l+"-"+e.r+"-"+e.type}),s.enter().append("svg:line").attr("class","link").style("stroke-width",function(e){return""+(2+e.weight)}).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),s.exit().remove(),f=d3.select("#directors_network .chart g.nodes").selectAll("g.node").data(l,function(e){return e.id}),f.select("image").attr("height",function(e){return e.root?32:n(e)}).attr("width",function(e){return e.root?32:n(e)}),u=f.enter().append("svg:g").attr("class",function(e){return e.root?"node root":"node"}).call(o.drag),u.append("svg:image").attr("xlink:href",function(e){return e.profile_image_url}).attr("height",function(e){return e.root?32:n(e)}).attr("width",function(e){return e.root?32:n(e)}).attr("class","node-img").attr("data-org",function(e){return"_"+e.id}),u.append("svg:text").attr("dy",function(e){return e.root?42:n(e)*1.5}).attr("dx",function(e){return e.root?16:n(e)*.5}).attr("text-anchor","middle").text(function(e){return e.name.replace(/\s+$/,"").replace(/LIMITED$/,"LTD")}),i=u.append("svg:g").attr("style","visibility:hidden"),i.append("svg:rect").attr("rx",5).attr("ry",5).attr("width",100).attr("height",100).attr("style","fill:white;stroke:black;stroke-width:2;opacity:0.9"),i.append("svg:text").attr("text-anchor","middle").text("ala ma kota"),f.exit().remove(),o.on("tick",function(){var e,r,i;return r=$("#directors_network .chart").width()/2,i=$("#directors_network .chart").height()/2,e=d3.select("#directors_network .chart g.edges").selectAll("line.link"),l=d3.select("#directors_network .chart g.nodes").selectAll("g.node"),e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("stroke",function(e){return t(e)}),l.attr("transform",function(e){var t;return t=e.root?16:n(e)/2,"translate("+(e.x-t)+","+(e.y-t)+")"})}),o.start()},f(i)}}}),Number.prototype.formatNumber=function(e,t,n){var r,i,s,o;return s=this,e=isNaN(e=Math.abs(e))?2:e,t=t===void 0?".":t,n=n===void 0?",":n,o=s<0?"-":"",r=parseInt(s=Math.abs(+s||0).toFixed(e))+"",i=r.length,i=i>3?i%3:0,o+(i?r.substr(0,i)+n:"")+r.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(s-r).toFixed(e).slice(2):"")},Number.prototype.formatMoney=function(e){var t;return e=e||"£",t=this,t<=-1e12?"-"+e+(-t/1e12).formatNumber(1,".",",")+"tn":t<=-1e9?"-"+e+(-t/1e9).formatNumber(1,".",",")+"bn":t<=-1e6?"-"+e+(-t/1e6).formatNumber(1,".",",")+"m":t<=-1e3?"-"+e+(-t/1e3).formatNumber(1,".",",")+"k":t<0?"-"+e+t.formatNumber(2,".",","):t<1e3?e+t.formatNumber(2,".",","):t<1e6?e+(t/1e3).formatNumber(1,".",",")+"k":t<1e9?e+(t/1e6).formatNumber(1,".",",")+"m":t<1e12?e+(t/1e9).formatNumber(1,".",",")+"bn":e+(t/1e12).formatNumber(1,".",",")+"tn"};var margin_bottom,margin_top,relayout,throttled_relayout;margin_top=0,margin_bottom=0,relayout=function(){var e,t,n;if($("body").hasClass("map-view"))return e=$("body").height(),n=$(".sticky-header").height(),t=$(".sticky-footer").offset().top,$(".sticky-content").offset({top:n+margin_top,left:0}).css("bottom",e-t+margin_bottom)},throttled_relayout=_.throttle(relayout,50),$(function(){var e;return $(window).resize(throttled_relayout),$("body.map-view .sticky-footer").live("hover",function(){return $("body").scrollTop(1e5)}),$("body.map-view .sticky-footer").live("mouseleave",function(){return $("body").scrollTop(0)}),e=window.setInterval(throttled_relayout,1e3),relayout()}),function(e,t){var n;return n=e(t),e.fn.lazy=function(r){var i,s,o,u;return u=function(){var t;return t=0,s.each(function(){var n;n=e(this);if(!e.abovethetop(this,o)&&!e.leftofbegin(this,o)){if(!e.belowthefold(this,o)&&!e.rightoffold(this,o))return n.trigger("appear"),t=0;if(++t>o.failure_limit)return!1}})},s=this,i=void 0,o={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,appear:null,load:null},r&&(void 0!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),void 0!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),e.extend(o,r)),i=o.container===void 0||o.container===t?n:e(o.container),0===o.event.indexOf("scroll")&&i.bind(o.event,_.debounce(function(e){return u()},200)),this.each(function(){var t,n;n=this,t=e(n),n.loaded=!1,t.one("appear",function(){var t;if(!this.loaded&&!this.loading&&o.appear)return n.loading=!0,t=e.grep(s,function(e){return!e.loading}),s=e(t),o.appear.call(n)});if(0!==o.event.indexOf("scroll"))return t.bind(o.event,function(e){if(!n.loaded)return t.trigger("appear")})}),n.bind("resize",function(e){return u()}),e(document).ready(function(){return u()}),this},e.belowthefold=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.height()+n.scrollTop():s=e(i.container).offset().top+e(i.container).height(),s<=e(r).offset().top-i.threshold},e.rightoffold=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.width()+n.scrollLeft():s=e(i.container).offset().left+e(i.container).width(),s<=e(r).offset().left-i.threshold},e.abovethetop=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.scrollTop():s=e(i.container).offset().top,s>=e(r).offset().top+i.threshold+e(r).height()},e.leftofbegin=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.scrollLeft():s=e(i.container).offset().left,s>=e(r).offset().left+i.threshold+e(r).width()},e.inviewport=function(t,n){return!e.rightoffold(t,n)&&!e.leftofbegin(t,n)&&!e.belowthefold(t,n)&&!e.abovethetop(t,n)},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window),define("linkedin_api",["domready!"],function(){var e,t,n;return e=function(e){var t;return t=IN.User.isAuthorized(),t?$("body").addClass("in-authorised"):$("body").addClass("in-not-authorised"),e(IN)},n=0,t=function(){return n+=1,"__linkedin_api_req_"+n+"__"},{load:function(n,r,i,s){var o;return s.isBuild?i(null):(o=t(),window[o]=function(){return e(i)},$.getScript("http://platform.linkedin.com/in.js?async=true",function(){return IN.init({onLoad:o,api_key:"cmsbsh94fl9j",authorize:!0,scope:"r_basicprofile r_network"})}))}}}),define("linkedin",["text!/partials/linkedin-template.html","linkedin_api!"],function(e,t){var n,r;return n=Handlebars.compile(e),r={first_page:{},full:{},summary:{}},$(".in-login").live("click",function(){return IN.User.authorize(function(){return $("body").removeClass("in-not-authorised"),$("body").addClass("in-authorised")})}),$(".in-logout").live("click",function(){return IN.User.logout(function(){return $("body").removeClass("in-authorised"),$("body").addClass("in-not-authorised")})}),{get_single_page_linkedin_contacts:function(e,t,n,r){var i,s;return i=$.Deferred(),s={sort:"distance","current-company":!0,start:t,count:n,"company-name":e},r&&(s.facet=r),IN.API.PeopleSearch().fields("id","firstName","lastName","headline","pictureUrl","publicProfileUrl","distance").params(s).result(function(e,t){return i.resolve(e)}).error(function(e){return i.reject(e)}),i},get_first_page_linkedin_contacts:function(e,t){if(!r.first_page[e]||r.first_page[e].state()==="rejected")r.first_page[e]=this.get_single_page_linkedin_contacts(e,0,t);return r.first_page[e]},get_all_linkedin_contacts:function(e){var t,n,i,s;s=Date.now().getTime(),console.log("a "+(Date.now().getTime()-s));if(!r.full[e]||r.full[e].state()==="rejected")t=$.Deferred(),r.full[e]=t,console.log("b "+(Date.now().getTime()-s)),n=get_first_page_linkedin_contacts(e,25),i=[n],console.log("c "+(Date.now().getTime()-s)),n.done(function(n){var r,o,u,a;a=n.people._total,r=n.people._count,u=Math.ceil((a-r)/25),o=0;while(o<u)i.push(this.get_single_page_linkedin_contacts(e,r+o*25,25)),o++;return console.log("linked in first "+(Date.now().getTime()-s)),$.when.apply(this,i).done(function(e,n,r,i,o,u){var a;return a=_.chain(arguments).pluck("people").map(function(e){return e.values}).flatten().value(),console.log("linked in fetched "+_.size(a)+"contacts in "+(Date.now().getTime()-s)),t.resolve(a)}).fail(function(){return t.reject(arguments)})});return r.full[e]},render_linkedin_contacts:function(e){var t;return t="comarch",$("#company_view .linkedin-details").html(""),get_all_linkedin_contacts(t).done(function(e){var t;return t=n(e),$("#company_view .linkedin-details").html(t)})},get_linkedin_summary:function(e){var t,n,i;if(!r.summary[e]||r.summary[e].state()==="rejected")t=$.Deferred(),r.summary[e]=t,n=this.get_single_page_linkedin_contacts(e,0,1,"network,F"),i=this.get_single_page_linkedin_contacts(e,0,1,"network,S"),$.when(n,i).done(function(e,n){return t.resolve({first_degree:e.numResults,second_degree:n.numResults})}).fail(function(){return t.reject(arguments)});return r.summary[e]},get_all_linkedin_data:function(e){var t,n,r;return r=Date.now().getTime(),console.log("a "+(Date.now().getTime()-r)),t=$.Deferred(),console.log("b "+(Date.now().getTime()-r)),n=[],_.each(e,function(e){return n.push(this.get_single_page_linkedin_contacts(e.name,0,1,"network,F")),n.push(this.get_single_page_linkedin_contacts(e.name,0,1,"network,S"))}),console.log("c "+(Date.now().getTime()-r)),$.when.apply(this,n).done(function(e,n,i,s,o,u){var a;return a=_.chain(arguments).pluck("people").map(function(e){return e.values}).flatten().value(),console.log("linked in fetched ALL"+_.size(a)+"contacts in "+(Date.now().getTime()-r)),t.resolve(a)}).fail(function(){return t.reject(arguments)}),t}}}),define("map",["maps_api","domready!"],function(e,t){var n,r,i;return n=new google.maps.LatLng(52.207607,.140848),i={zoom:14,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggableCursor:"pointer",noClear:!1,styles:[{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"},{weight:.5},{color:"#c0c0c0"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"},{weight:.3},{color:"#808080"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{visibility:"simplified"},{weight:1},{color:"#a0a0a0"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"},{weight:.3},{color:"#808080"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"},{weight:1},{color:"#ac2046"}]}]},r=new google.maps.Map(document.getElementById("map_canvas"),i),r}),define("maps_api",["google!maps,3.x,other_params:sensor=false"],function(){return window.google.maps}),define("model",["graph"],function(e){var t,n=this;return t={},t.focused_node=void 0,t.focused_org=void 0,t.title="Cambridge Cluster Map ",t.description=ko.observable(""),t.view=ko.observable("map"),t.location=ko.observable(""),t.path_rest=ko.computed(function(){return _.tail(t.location().replace(/^\//,"").split("/")).join("/")}),t.org_displaying=ko.observable(e.orgs_by_id),t.org_displaying_count=ko.computed(function(){return _.size(t.org_displaying()).formatNumber(0,".",",")}),t.org_displaying_employees=ko.computed(function(){return _.reduce(t.org_displaying(),function(e,t){return e+(t.employee_count||0)},0).formatNumber(0,".",",")}),t.org_displaying_revenue=ko.computed(function(){return _.reduce(t.org_displaying(),function(e,t){return e+(t.last_revenue||0)},0).formatMoney()}),t.total_count=ko.observable(_.size(e.orgs_by_id).formatNumber(0,".",",")),t.total_employees=ko.observable(_.reduce(e.orgs_by_id,function(e,t){return e+(t.employee_count||0)},0).formatNumber(0,".",",")),t.total_revenue=ko.observable(_.reduce(e.orgs_by_id,function(e,t){return e+(t.last_revenue||0)},0).formatMoney()),t.egonet_companies_rank=ko.observable("influence"),t.egonet_network_rank=ko.observable("mention"),t.showing_message=ko.computed(function(){return _.isEmpty(t.description())?"Showing: All companies":"Showing: "+t.description()}),window.model=t,t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("BuildingMVC",["model","graph","map","maps_api"],function(e,t,n){var r;return r=function(e){function p(e,i){var a,f,l=this;this.node=e,f=new google.maps.LatLng(this.node.latitude,this.node.longitude),console.log(t),a=_.reduce(this.node.ids,function(e,n){return e+(t.orgs_by_id[n].employee_count||1)},0),this.marker=new google.maps.Marker({icon:r(this.node.ids.length>1,a),node:this.node,clickable:!0,optimized:!1,zIndex:i,labelClass:"labels"}),this.revenueCircle=new google.maps.Circle({clickable:!1,fillColor:"#F2C674",fillOpacity:.2,strokeOpacity:0}),this.set("labelContent",o(this.node,t)),this.marker.bindTo("labelContent",this),this.set("radius",u(this.node,t)),this.set("fillColor",s(this.node,t)),this.revenueCircle.bindTo("fillColor",this),this.revenueCircle.bindTo("center",this,"position"),this.revenueCircle.bindTo("radius",this),google.maps.event.addListener(this.marker,"label-click",function(){return techcitymap.sammy.context.redirect("#/company/"+l.getLabelData("org_id"))}),this.marker.bindTo("position",this),this.set("position",f),this.setMap(n,!1),this.node.building=this,this.node.marker=this.marker}var r,i,s,o,u,a,f,l,c,h;return __extends(p,e),p.prototype.refreshIcon=function(e,t){return this.set("icon",r(e,t))},p.prototype.refreshDisc=function(){return this.set("radius",u(this.node,t)),this.set("fillColor",s(this.node,t))},p.prototype.refreshLabel=function(){return this.set("labelContent",o(this.node,t))},c=function(e,t){return p.prototype.displaying_orgs_by_node(e.ids,t)},h=new google.maps.MarkerImage("/images/Single_lvl1_a_01.png"),r=function(e,t){var n,r,i;return t===0&&h,i="1",t>500?i="5":t>101?i="4":t>16?i="3":t>6?i="2":i="1",n="/img/"+(e?"Multiple_lvl":"Single_lvl")+i+"_a_01.png",r=new google.maps.MarkerImage(n),r},a=function(e){return(_.find(e.tags,function(e){return e.type==="diskcolor"})||{}).description||"gray"},f=function(e,t){return _.max(c(e,t),function(e){return e.last_revenue})||0},l=function(e,t){return _.reduce(c(e,t),function(e,t){return e+(t.last_revenue||1)},0)},s=function(e,t){var n;return n=f(e,t),a(n)},u=function(e,t){var n;return n=l(e,t),n<5e6?50:n<2e7?100:n<1e8?150:n<25e7?300:500},o=function(e,t){return f(e,t).name},i=function(e,t){return f(e,t)},p.prototype.setMap=function(e,t){return this.marker.setMap(e,t),this.revenueCircle.setMap(e)},p}(google.maps.MVCObject),r.prototype.displaying_orgs_by_node=function(t,n){var r;return r=e.org_displaying(),_.reduce(t,function(e,t){return r[t]&&e.push(n.orgs_by_id[t]),e},[])},r});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("CompanyMVC",["model","BuildingMVC","TooltipMVC","map","graph","text!/partials/hover-info.html","maps_api"],function(e,t,n,r,i,s){var o;return o=function(o){function h(t,r){var i=this;this.tooltipOverlay=new n(t,"hover_info"),this.set("map",t),_.each(r,function(e){return i.addNode(e)}),$("#hover_info .outer").live("mouseleave",function(){return l.handle("mouse_leave_tooltip",i)}),$("#hover_info .outer").live("mouseenter",function(){return l.handle("mouse_enter_tooltip",i)}),e.org_displaying.subscribe(function(e){return i.refreshIcons(e)})}var u,a,f,l,c;return __extends(h,o),h.prototype.refreshIcons=function(e){var t,n;return n=1,t=_.size(e),_.each(i.nodes,function(s){var o,u,a;return t>0?(u=_.reduce(s.ids,function(t,n){return e[n]?t+1:t},0),u>0?(s.building.setMap(r,t<60),o=_.reduce(s.ids,function(t,n){return e[n]&&(t+=i.orgs_by_id[n].employee_count||0),t},0),a=_.reduce(s.ids,function(t,n){return e[n]&&(t+=i.orgs_by_id[n].last_revenue||0),t},0),s.building.refreshIcon(u>1,o),s.building.refreshDisc(),s.building.refreshLabel(),s.marker.setZIndex(n++)):s.building.setMap(null)):s.building.setMap(null)})},h.prototype.resize=function(){return google.maps.event.trigger(this.get("map"),"resize")},f=Handlebars.compile(s),c=function(e){var t;return t=f(e),$("#hover_info .template").replaceWith(t)},a=function(e,t){var n,r,i,s,o;return r=function(){var t,r;return r=null,t=e.apply(s,n)},n=void 0,i=void 0,s=void 0,o=void 0,function(){var u;return u=_.head(arguments),n=_.tail(arguments),s=this,clearTimeout(o),u?i=e.apply(s,n):o=setTimeout(r,t),i}},u=null,l=new machina.Fsm({signal:function(){var e;return e=function(e,t,n){if(!t)return e.hide_tooltip(),u=null,console.log("off"),this.transition("off");if(n!==u)return e.show_tooltip(n.marker),u=n,console.log("on",n.ids),this.transition("on")},a(e,500)}(),initialState:"off",states:{on:{mouse_enter:function(e,t){if(t!==u)return console.log("on: mouse_enter",t.ids),this.signal(!1,e,!0,t)},mouse_click:function(e,t){if(t!==u)return console.log("on: mouse_click",t.ids),this.signal(!0,e,!0,t)},mouse_leave:function(e){return console.log("on: mouse_leave"),this.signal(!1,e,!1,u.ids)},mouse_enter_tooltip:function(e){return console.log("on: mouse_enters_tooltip",u.ids),this.signal(!0,e,!0,u)},mouse_leave_tooltip:function(e){return console.log("tooltip: mouse_leaves_tooltip",u.ids),this.signal(!1,e,!1,u)}},off:{mouse_enter:function(e,t){return console.log("off: mouse_enter",t.ids),this.signal(!0,e,!0,t)},mouse_click:function(e,t){return console.log("off: mouse_click",t.ids),this.signal(!0,e,!0,t)},mouse_leave:function(){},mouse_enter_tooltip:function(e){return console.error("it should never happen")},mouse_leave_tooltip:function(e){return console.error("it should never happen")}}}}),h.prototype.show_tooltip=function(e){var n,r,s;return r=e.node,n={},n.org=null,n.orgs=_.filter(t.prototype.displaying_orgs_by_node(r.ids,i),function(e){return!0}),c(n),s=this.tooltipOverlay.getProjection().fromLatLngToDivPixel(e.get("position")),$("#hover_info .outer").css("display","block").css("visibility","hidden"),$("#hover_info").css({left:s.x,top:s.y-$("#hover_info").height()-30}),$("#hover_info .outer").stop().css("visibility","visible").css("opacity","").fadeIn(400)},h.prototype.hide_tooltip=function(){return this.tooltipOverlay.div.find(".outer").css("visibility","hidden")},h.prototype.fadeout_tooltip=function(){return this.tooltipOverlay.div.find(".outer").stop().fadeOut(500)},h.prototype.click_marker=function(e){return l.handle("mouse_click",this,e.node)},h.prototype.enter_marker=function(e){return l.handle("mouse_enter",this,e.node)},h.prototype.leave_marker=function(){return l.handle("mouse_leave",this)},h.prototype.addNode=function(e,n){var r,i=this;return r=new t(e,n),google.maps.event.addListener(r.marker,"click",function(){return l.handle("mouse_click",i,r.marker.node)}),google.maps.event.addListener(r.marker,"mouseover",function(){return l.handle("mouse_enter",i,r.marker.node)}),google.maps.event.addListener(r.marker,"mouseout",function(){return l.handle("mouse_leave",i)}),e},h.prototype.showTooltipByOrgId=function(e,t,n){var r,s,o,u,a,l;a=i.orgs_by_id[t],u=i.nodes_by_org_id[t],o=u.marker,l=e.getProjection().fromLatLngToDivPixel(o.get("position")),e.div.find(".outer").css("display","block").css("visibility","hidden"),r={org:a},s=f(r),e.div.find(".template").replaceWith(s),e.div.find(".tweet").html(graph_model.tweets_by_org_id()[t]),e.div.css({left:l.x,top:l.y-e.div.height()-20}),e.div.find(".outer").stop().css("visibility","visible").css("opacity","").fadeIn(400);if(n)return n(a)},h.prototype.navigateToNodeByOrgId=function(e,t){var n=this;return this.showTooltipByOrgId(e,t,function(e){return n.get("map").panTo(new google.maps.LatLng(e.latitude,e.longitude))})},h.prototype.template_tooltip=function(e){var t;return t=f(e),$("#hover_info .template").replaceWith(t)},h}(google.maps.MVCObject)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("TooltipMVC",["map"],function(e){var t;return t=function(e){function t(e,t){this.dom_id=t,this.set("map",e)}return __extends(t,e),t.prototype.onAdd=function(){var e;return this.div=$('<div id="'+this.dom_id+'" class="hover-info">'+'<div class="outer" style="visibility:hidden;">'+'  <div class="arrow-bottom"></div>'+'  <div class="inner">'+'    <div class="arrow-top"></div>'+'    <div class="template"></div>'+"  </div>"+"</div>"+"</div>"),e=this.getPanes().overlayMouseTarget,e.appendChild(this.div.get(0)),{mouseleave:function(e){return this.div.find(".outer").mouseleave(e)},mouseenter:function(e){return this.div.find(".outer").mouseenter(e)}}},t.prototype.draw=function(){},t}(google.maps.OverlayView)}),define("graph",["json!/data/geohash.json"],function(e){var t,n,r,i;return r=e.data.companies,t=e.data.nodes,i=_.reduce(r,function(e,t){return e[t.id]=t,e},{}),n=_.reduce(t,function(e,t){return _.reduce(t.ids,function(e,n){return e[n]=t,e},e)},{}),{orgs:r,nodes:t,orgs_by_id:i,nodes_by_org_id:n}}),define("nodes",["json!/data/geohash.json","CompanyMVC","map","HandlebarsHelpers"],function(e,t,n){var r;return r=new t(n,e.data.nodes),$("#loading_view").hide(),$("#map_view").show()}),define("org_view",["charts","model","text!/partials/company_details.html","api"],function(e,t,n,r){var i;return i=Handlebars.compile(n),{display_company_details:function(e,n,s){return r.get_company_by_id(e,function(r){var o;console.log("org_in_focus",r),$("#update-a-company-dialog form").reset().decorate(),$("#update-a-company-dialog form").get(0).reset(),$("#company_name_u").val(r.name),$("#company_contact_email_u").val(""),$("#company_twitter_screen_name_u").val(r.twitter_screen_name),$("#company_address_u").val(r.address),$("#company_postcode_u").val(r.postcode),$("#company_employee_count_u").val(r.employee_count||0),$("#verification_email_u").val(""),$("#company_natural_id_u").val(r.id),$("#company_web_url_u").val(r.web_url),$("#company_sector_u").val((_.find(r.tags,function(e){return e.type==="sector"})||{}).tag),$("#company_description_u").val(r.description),$("#company_member_camnetwork_u").attr("checked",_.any(r.tags,function(e){return e.type==="view"&&e.tag==="camnetwork"})?"checked":null),$("#company_cuequity_univenture_u").attr("checked",_.any(r.tags,function(e){return e.type==="cuequity"&&e.tag==="univenture"})?"checked":null),$("#company_member_onenucleus_u").attr("checked",_.any(r.tags,function(e){return e.type==="view"&&e.tag==="onenucleus"})?"checked":null),$("#company_warrant_u").attr("checked",null),$("#company_dissolved_u").attr("checked",null),r.badges=_.reduce(r.tags,function(e,t){return t.type==="badge"&&(e[t.tag]=!0),e},{}),r.sector=(_.find(r.tags,function(e){return e.type==="sector"})||{}).description||"",o=i(r),$("#company_view").html(o),$("#company_view .update-company a").data("org_id",e),r.badges.top50rev&&$(".company-details img.badge_rev").show(),r.badges.top50emp&&$(".company-details img.badge_emp").show(),r.badges.camenterprise&&$(".company-details img.badge_uni").show(),ko.applyBindings(t,document.getElementById("company_view")),$(".top-shared-interest .body").collapsorz({minimum:20,showText:"more",hideText:"less",linkLocation:".top-shared-interest .header"}),$(".top-mentioned .body").collapsorz({minimum:20,showText:"more",hideText:"less",linkLocation:".top-shared-interest .header"}),$(".top-mentions .body").collapsorz({minimum:20,showText:"more",hideText:"less",linkLocation:".top-shared-interest .header"}),s(r);if(n)return n(e,r)})}}}),define("org_view_twitter",[],function(){return{display_twitts:function(e){return $(".wrapper .tweets .tab .body .tweet-list").remove(),$(".wrapper .tweets .tab .body").tweet({query:"@"+e,refresh_interval:15,join_text:"auto",avatar_size:26,count:6,auto_join_text_default:"",auto_join_text_ed:"",auto_join_text_ing:"",auto_join_text_reply:"",auto_join_text_url:"",loading_text:"loading tweets...",template:"<div class='c1'>{avatar}</div><div class='c2'>{time} {text}</div>"})}}}),define("orgs_table",["model","graph","linkedin"],function(e,t,n){var r,i,s;return jQuery.fn.dataTableExt.oSort["percent-asc"]=function(e,t){var n,r;return n=e.replace(/%/g,""),r=t.replace(/%/g,""),n=parseInt(n),r=parseInt(r),n-r},$.fn.dataTableExt.oSort["percent-desc"]=function(e,t){return-1*$.fn.dataTableExt.oSort["percent-asc"](e,t)},jQuery.extend(jQuery.fn.dataTableExt.oSort,{"data-value-pre":function(e){return parseFloat(e.match(/data-value=('|")(.*?)('|")/)[2])},"data-value-asc":function(e,t){return e<t?-1:e>t?1:0},"data-value-desc":function(e,t){return e<t?1:e>t?-1:0}}),$.fn.dataTableExtsErrMode="throw",s=$("#list_view table").dataTable({bFilter:!1,bAutoWidth:!1,aaData:[],aoColumns:[{bVisible:!1},{sWidth:"60px",bSortable:!1,sTitle:"Logo",sClass:"text-left",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<img class='logo' original='"+t+"' width='48' height='48'> "}},{sTitle:"Company",sClass:"name text-left",fnRender:function(e){var t;return t=e.aData[0],"<a href='/company/"+t+"'>"+e.aData[e.iDataColumn]+"</a>"}},{sTitle:"Connections",bSortable:!1,sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[0],n=e.aData[e.iDataColumn],"<span class='linkedin-org' data-org-name='"+n+"' data-org-id='"+t+"'>"+"<span class='linkedin-progress'></span>"+"<table style='display:none;'>"+"  <tr>"+"    <td>"+"       <span class='badge badge-linkedin'>1st</span>"+"    </td>"+"    <td>"+"      <span class='F'>12312312</span>"+"    </td>"+"  </tr>"+"  <tr>"+"    <td>"+"       <span class='badge badge-linkedin'>2nd</span>"+"    </td>"+"    <td>"+"      <span class='S'>12312312</span>"+"    </td>"+"  </tr>"+"</table>"+"</span>"}},{sTitle:"Badges",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn],n=(t.top50rev?8:0)+(t.top50emp?4:0)+(t.camenterprise?2:0)+(t.businessweekly?1:0),"<span data-value='"+n+"'>"+(t.top50rev?"<img src='/img/badge_rev.png' > ":"")+(t.top50emp?"<img src='/img/badge_emp.png' > ":"")+(t.camenterprise?"<img src='/img/badge_uni.png' > ":"")+(t.businessweekly?"<img src='/img/badge_bw.png' > ":"")+"</span>"}},{sTitle:"Sector",sWidth:"160px",sType:"string"},{bVisible:!1},{sTitle:"Revenue",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn],n=e.aData[e.iDataColumn-1],"<span data-value='"+t+"'>"+t.formatMoney()+" <span class='smaller'>("+n+")</span>"+"</span>"}},{sTitle:"Revenue<br/>Change",sWidth:"120px",sType:"data-value",sClass:"text-right",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<span data-value='"+t+"' class='"+(t>=0?"positive":"negative")+"'>"+t.formatMoney()+(t>=0?" ▲":" ▼")+"</span>"}},{bVisible:!1},{sTitle:"Employees",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn]||0,n=e.aData[e.iDataColumn-1],"<span data-value='"+t+"'>"+t.formatNumber(0,".",",")+" <span class='smaller'>("+n+")</span>"+"</span>"}},{sTitle:"Employee<br/>Change",sWidth:"120px",sType:"data-value",sClass:"text-right",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<span data-value='"+t+"' class='"+(t>=0?"positive":"negative")+"'>"+t.formatNumber(0,".",",")+(t>=0?" ▲":" ▼")+"</span>"}}],bLengthChange:!1,iDisplayLength:1e3,fnDrawCallback:function(){return $("#list_view").is(":visible")},oLanguage:{sZeroRecords:"... Loading ..."}}),r=_.map(e.org_displaying(),function(e){return[e.id,e.profile_image_url||"",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}),s.fnAddData(r),e.org_displaying.subscribe(function(e){return r=void 0,_.isEmpty(e)?r=_.map(t.companies,function(e){return[e.id,e.profile_image_url||"_",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}):r=_.map(e,function(e){return[e.id,e.profile_image_url||"_",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}),s.fnClearTable(),s.fnAddData(r)}),i=function(){return $("#list_view .linkedin-org").lazy({appear:function(e){var t,r;return r="comarch",t=$(this),n.get_linkedin_summary(r).done(function(e){return t.find(".linkedin-progress").hide(),t.find(".F").text(e.first_degree),t.find(".S").text(e.second_degree),t.find("table").show()})}})},e.view.subscribe(function(e){if(e==="list")return s.fnAdjustColumnSizing(),i()}),e.org_displaying.subscribe(function(e){return i()})}),define("router",["api","org_view_twitter","charts","force","org_view","graph","model","HandlebarsHelpers"],function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d=this;return l=new Sammy.Application(function(){var e;return this.debug=!0,this.use(Sammy.Handlebars,"hb"),e={}}),l.bind("location-changed",function(e,t,n){return o.location(l.getLocation())}),a=function(e){return i.display_company_details(e,function(e,r){return n.rednder_revenue_overview(r),t.display_twitts(r.screen_name)},function(t){return r.render_directors_network(e,t)})},h=_.reduce(s.orgs,function(e,t){return _.reduce(t.tags,function(e,t){return e[t.type]=e[t.type]||{},e[t.type][t.tag]=!0,e},e)},{}),c=function(){var e;return e=!0,function(t,n){var r;$(".view").hide(),$("#loading_view").hide(),$("#map_view").show(),o.view("map"),google.maps.event.trigger(t,"resize");if(e)return r=new n(t,s.nodes),e=!1,t.panTo(new google.maps.LatLng(52.205,.122))}}(),$(".company-navi").live("click",function(e){return e.preventDefault(),l.setLocation("/company/"+$(this).data("id")),null}),l.get("/",function(){return require(["map","CompanyMVC"],function(e,t){var n;return $(window).scrollTop(0),document.title=o.title+" - "+"All companies",o.org_displaying(s.orgs_by_id),n="All companies",c(e,t)})}),l.get("/company/:id",function(){return document.title=o.title+" - "+"Company",$(".view").hide(),$("#loading_view").show(),a(this.params.id),o.view("org"),$("div.hover-info .outer").hide(),$(".sticky-content .view").hide(),$("#loading_view").hide(),$("#company_view").show()}),l.get("/on_map/:id",function(){var e;return require(["CompanyMVC"],function(e){}),$(window).scrollTop(0),document.title=o.title+" - "+"All companies",c(),o.description(""),e=this.params.id,o.focused_node=s.nodes_by_org_id[e],o.focused_org=s.orgs_by_id[e],mvc.navigateToNodeByOrgId(focusOverlay,e)}),l.get("/list",function(e){return require(["orgs_table"],function(e){return $(".view").hide(),$("#list_view").show(),o.org_displaying(s.orgs_by_id),o.view("list")})}),l.get("/about",function(e){return $(".view").hide()}),l.get("/your_browser_is_not_supported",function(e){return $(".view").hide(),$("#not-supported-browser-dialog").show(),_gaq.push(["_trackEvent","browser_unsupported"])}),_.each(h,function(e,t){var n;return n=_.keys(e).join("|"),l.get(new RegExp("/map/"+t+"/("+n+")$"),function(e){return require(["map","CompanyMVC"],function(n,r){var i,u;return u=e.params.splat[0]||!1,i=s.orgs_by_id,u&&(i=_.reduce(i,function(e,n){return _.any(n.tags,function(e){return e.type===t&&e.tag===u?(o.description(e.description),!0):!1})&&(e[n.id]=n),e},{})),o.org_displaying(i),$(window).scrollTop(0),document.title=o.title+" - "+o.description(),c(n,r)})})}),_.each(h,function(e,t){var n;return n=_.keys(e).join("|"),l.get(new RegExp("/list/"+t+"/("+n+")$"),function(e){var n,r;return r=e.params.splat[0]||!1,n=s.orgs_by_id,r&&(n=_.reduce(n,function(e,n){return _.any(n.tags,function(e){return e.type===t&&e.tag===r?(o.description(e.description),!0):!1})&&(e[n.id]=n),e},{})),o.org_displaying(n),require(["orgs_table"],function(e){return $(".view").hide(),$("#list_view").show(),o.view("list")})})}),l.get("",function(e){return e.redirect("/")}),l.before(function(e){var t;return t=l.routablePath(this.path).replace(/^\//,"").split("/")[0],$("body").attr("class",""),t!==""?$("body").addClass(t+"-view"):$("body").addClass("map-view")}),l.before(function(e){return $("#twitter_button").attr("src","http://platform.twitter.com/widgets/tweet_button.html?count=none&original_referer="+encodeURIComponent(location.href)+"&url="+encodeURIComponent(location.href)+"&text="+encodeURIComponent("Cambridge Cluster Map"))}),l.before(function(e){return _gaq.push(["_trackPageview",this.path])}),f=_.size(s.companies),u=_.reduce(s.companies,function(e,t){return e+(t.employee_count||0)},0),p=_.reduce(s.companies,function(e,t){return e+(t.last_revenue||0)},0),$("#count .result").text(f.formatNumber(0,".",",")),$("#employee_count .result").text(u.formatNumber(0,".",",")),$("#total_revenue .result").text(p.formatMoney()),$(".showing-bar .orgs .n").text(f.formatNumber(0,".",",")),$(".showing-bar .emp .n").text(u.formatNumber(0,".",",")),$(".showing-bar .rev .n").text(p.formatMoney()),ko.applyBindings(o),$("input.search").typeahead({source:function(t,n){return console.log(t),$.when(e.search_org_by_name(t),e.search_tags(t)).then(function(e,t){return n(e.concat(t))}),void 0},sorter:function(e){return e},matcher:function(){return!0},highlighter:function(e){return e.name?"<div>"+e.name+"</div>":"<div>"+e.description+" ("+e.count+")</div>"},updater:function(e){return e.type?l.setLocation("/"+o.view()+"/"+e.type+"/"+e.tag):(o.focused_node=void 0,o.focused_org=void 0,o.org_displaying(s.orgs_by_id),l.setLocation("/company/"+e.id))},minLength:3}),l._location_proxy.has_history?l.run():l.run("/#"),l}),function(e){function t(){this.lock=0}function n(t){return e(t).parent().size()>0}function r(t,n,r,i,s){var o=this;this.name=t,this.message=i,this.error_message=r,this.validationFunction=n,this.init=s||e.noop,e.extend(o,{test:function(e,t,n,r){var i=!1,s=function(e){i||(i=!0,r(e))},o=this.validationFunction.call(this,e,t,n,s);o!==undefined&&!i&&(i=!0,r&&r(o))},validMessage:function(){return this.message},invalidMessage:function(){return this.error_message},toString:function(){return"name:"+this.name+" message:"+this.message+" error_message:"+this.error_message}})}function i(n){var r=this,i=[],s={},o=undefined,u=e.vanadium.guid++,a=new t,f=!1;e.extend(r,{parse:function(){var t=e.vanadium.parse(n);return i=t[0],s=t[1],_.each(i,function(e){e.element=n}),r},validate:function(t){return this.parse(),o={},_.each(i,function(t){var i=e.vanadium.validator_types[t.name];i&&(i.init(t),(!o[i.name]||!i[i.name].success)&&i.test(n.val(),t.param,n.get(0),a.sync(function(a){f=!0;var l=a?i.message:i.error_message;e.isFunction(l)&&(l=l(n.val(),t.param,r));var c={success:a,name:i.name,advice_id:t.advice_id,message:l};o[i.name]=c;var h=t.advice_id||s.advice_id;if(h&&e("#"+h).size()==1){var p=e("#"+h);p.data("vanadium-elements")||p.data("vanadium-elements",{}),p.data("vanadium-elements")[u]||(p.data("vanadium-elements")[u]={}),p.data("vanadium-elements")[u][i.name]=c}f=!1})))}),n.trigger("on-validate"),r},decorate_advice:function(t){var n=t.data("vanadium-elements"),r=!0,i=e("<div>"+t.html()+"</div>");i.find("."+e.vanadium.conf.advice_class).remove();var s=[];n&&_.each(n,function(e){_.each(e,function(e){e.message&&s.push(e),r=r&&e.success})}),r?(t.addClass(e.vanadium.conf.valid_class),t.removeClass(e.vanadium.conf.invalid_class)):(t.removeClass(e.vanadium.conf.advice_class),t.removeClass(e.vanadium.conf.valid_class),t.addClass(e.vanadium.conf.invalid_class)),i.html().trim()!=""?r?t.hide():t.show():s.length==0?t.hide():(t.html(""),_.each(s,function(n){var r=e('<span class="'+e.vanadium.conf.advice_class+'"></span>').html(n.message);n.success?(r.addClass(e.vanadium.conf.valid_class),r.removeClass(e.vanadium.conf.invalid_class)):(r.removeClass(e.vanadium.conf.advice_class),r.removeClass(e.vanadium.conf.valid_class),r.addClass(e.vanadium.conf.invalid_class)),t.append(r)}),t.show())},decorate:a.sync(function(){o&&_.size(o)>0?_.some(_.values(o),function(e){return!e.success})?(n.removeClass(e.vanadium.conf.valid_class),n.addClass(e.vanadium.conf.invalid_class)):(n.addClass(e.vanadium.conf.valid_class),n.removeClass(e.vanadium.conf.invalid_class)):(n.removeClass(e.vanadium.conf.valid_class),n.removeClass(e.vanadium.conf.invalid_class)),_.each(i,function(t){var n=t.advice_id||s.advice_id;n&&e("#"+n).size()>0&&r.decorate_advice(e("#"+n))}),_.each(o,function(t){var n=t.advice_id||s.advice_id;n&&e("#"+n).size()>0&&r.decorate_advice(e("#"+n))});var t=e(n).parents(".\\"+e.vanadium.conf.prefix+e.vanadium.conf.container_class);return t.size()>0&&(t.data("vanadium-elements")||t.data("vanadium-elements",{}),t.data("vanadium-elements")[u]=this,t.each(function(){var t=e(this),n=_.some(t.data("vanadium-elements"),function(n,r){return n.element().parent().size()==0?(e(n.element()).removeData("vanadium-vanad"),n.element(undefined),delete t.data("vanadium-elements")[r],!1):_.some(n.validation_results(),function(e){return!e.success})});n?(e(this).removeClass(e.vanadium.conf.valid_class),e(this).addClass(e.vanadium.conf.invalid_class)):(e(this).addClass(e.vanadium.conf.valid_class),e(this).removeClass(e.vanadium.conf.invalid_class))})),n.trigger("on-decorate"),r}),reset_advice:function(e){var t=e.data("vanadium-elements");t&&delete t[u]},reset:function(){return _.each(o,function(t){t.advice_id&&e("#"+t.advice_id).size()>0&&r.reset_advice(e("#"+t.advice_id))}),o=undefined,n.trigger("on-reset"),r},uid:function(){return u},validation_results:function(){return o},element:function(e){var t=n;return arguments.length>0&&(n=e),t},valid:function(){return n.get(0).tagName=="FORM"?_.reduce(n.find("input, textarea, select"),function(t,n){return t&&!_.some(e(n).vanadium().validation_results()||[],function(e){return!e.success})},!0):o?!_.some(o,function(e){return!e.success}):!0}})}function s(e){return e==null||e.length==0}t.prototype.sync=function(e,t,n){var r=function(e){return!!e&&toString.call(e)==="[object Function]"},i=this;return function(){var s=this,o=Array.prototype.slice.call(arguments);(function u(){var a=i.lock++;a>0&&console&&console.debug&&console.debug("mutex lock: "+a);if(a!=0)setTimeout(u,1);else try{var f=e.apply(s,o);r(t)&&t.call(s,f)}catch(l){r(n)?n.call(s,l):console.error&&console.error(l)}finally{i.lock=0}})()}},e.vanadium={mutex:new t,version:"2.0",compatible_with_jquery:"1.4.2",conf:{prefix:":",separator:";",valid_class:"vanadium-valid",advice_class:"vanadium-advice",invalid_class:"vanadium-invalid",message_value_class:"vanadium-value",container_class:"container",language:"EN"},validator_types:{},guid:0,addValidatorType:function(t,n,i,s,o){e.vanadium.validator_types[t]=new r(t,n,i,s,o)},addValidatorTypes:function(t){var n=this;_.each(t,function(t){e.vanadium.addValidatorType.apply(n,t)})},on:function(){e("form").live("submit.vanadium",function(t){t.preventDefault();try{var n=e(this).find("input, textarea, chackbox, select");e.each(n,function(){e(this).vanadium().validate().decorate()})}catch(r){console.log(r)}})},off:function(){e("form").die(".vanadium")},parse_markup:function(t){if(t.indexOf(e.vanadium.conf.prefix)==0){var n=t.substr(e.vanadium.conf.prefix.length).split(e.vanadium.conf.separator);for(var r in n)n[r]==""&&(n[r]=undefined);return n}return undefined},validation_instance:function(e){var t=e[0];if(t!="only_on_blur"&&t!="only_on_submit"&&t!="wait"&&t!="advice"){var n=e[1],r=e[2];return{name:t,param:n,advice_id:r}}return undefined},validation_modifier:function(e){var t=e[0],n=e[1];if(t=="only_on_blur"||t=="only_on_submit")return{m_name:!0};if(t=="wait"){var r=parseInt(n);if(r!=NaN&&typeof r=="number")return{wait:r}}else if(t=="advice")return{advice_id:n};return undefined},parse:function(t){var n=e(t),r=[],i={},s;return n.attr("data-vanadium")?s=n.attr("data-vanadium").split(" "):n.attr("class")&&(s=n.attr("class").split(" ")),s&&_.each(s,function(t){var n=e.vanadium.parse_markup(t);n&&(r.push(e.vanadium.validation_instance(n)),e.extend(i,e.vanadium.validation_modifier(n)))}),[_.filter(r,function(e){return e}),i]}},e.fn.vanadium=function(){var t=e(this),n=t.data("vanadium-vanad");return n||(n=new i(t),e(t).data("vanadium-vanad",n)),n},e.fn.valid=function(){var t=e(this);return t.get(0).tagName=="INPUT"||t.get(0).tagName=="TEXTAREA"||t.get(0).tagName=="SELECT"?t.vanadium().valid():_.reduce(t.find("input, textarea, select"),function(t,n){return e(n).valid()||(t=t&&!1),t},!0)},e.fn.validate=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).validate()}):t.vanadium().validate()})},e.fn.decorate=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).decorate()}):t.vanadium().decorate()})},e.fn.reset=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).reset()}):t.vanadium().reset()})},e().jquery.indexOf(e.vanadium.compatible_with_jquery)!=0&&window.console&&window.console.warn&&console.warn("This version of Vanadium is tested with jQuery "+e.vanadium.compatible_with_jquery+" it may not work as expected with this version ("+e().jquery+")"),e.vanadium.addValidatorType("empty",s),e.vanadium.addValidatorTypes([["equal",function(e,t){return e==t},function(t,n){return'The value should be equal to <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span>."}],["equal_ignore_case",function(e,t){return e.toLowerCase()==t.toLowerCase()},function(t,n){return'The value should be equal to <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span>."}],["required",function(e){return!s(e)},"This is a required field."],["accept",function(e,t,n){return n.checked},"Must be accepted!"],["integer",function(e){if(s(e))return!0;var t=parseFloat(e);return!isNaN(t)&&t.toString()==e&&Math.round(t)==t},"Please enter a valid integer in this field."],["number",function(e){return s(e)||!isNaN(e)&&!/^\s+$/.test(e)},"Please enter a valid number in this field."],["float",function(e){return s(e)||!isNaN(e)&&!/^\s+$/.test(e)},"Please enter a valid number in this field."],["digits",function(e){return s(e)||!/[^\d]/.test(e)},"Please use numbers only in this field. please avoid spaces or other characters such as dots or commas."],["alpha",function(e){return s(e)||/^[a-zA-Z\u00C0-\u00FF\u0100-\u017E\u0391-\u03D6]+$/.test(e)},"Please use letters only in this field."],["asciialpha",function(e){return s(e)||/^[a-zA-Z]+$/.test(e)},"Please use ASCII letters only (a-z) in this field."],["alphanum",function(e){return s(e)||!/\W/.test(e)},"Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed."],["date",function(e){var t=new Date(e);return s(e)||!isNaN(t)},"Please enter a valid date."],["email",function(e){return s(e)||/[\w\.]{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(e)},"Please enter a valid email address. For example fred@domain.com ."],["url",function(e){return s(e)||/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(e)},"Please enter a valid URL."],["date_au",function(e){if(s(e))return!0;var t=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!t.test(e))return!1;var n=new Date(e.replace(t,"$2/$1/$3"));return parseInt(RegExp.$2,10)==1+n.getMonth()&&parseInt(RegExp.$1,10)==n.getDate()&&parseInt(RegExp.$3,10)==n.getFullYear()},"Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006."],["currency_dollar",function(e){return s(e)||/^\$?\-?([1-9]{1}[0-9]{0,2}(,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(e)},"Please enter a valid $ amount. For example $100.00 ."],["selection",function(e,t,n){return elm.options?elm.selectedIndex>0:!s(e)},"Please make a selection"],["one_required",function(t,n,r){var i=jQuery('input[name="'+elm.name+'"]');return _.some(i,function(t){return e(t).value()})},"Please select one of the above options."],["length",function(e,t){return t===undefined?!0:e.length==parseInt(t)},function(t,n){return'The value should be <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["min_length",function(e,t){return t===undefined?!0:e.length>=parseInt(t)},function(t,n){return'The value should be at least <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["max_length",function(e,t){return t===undefined?!0:e.length<=parseInt(t)},function(t,n){return'The value should be at most <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["same_as",function(e,t){if(t===undefined)return!0;var n=document.getElementById(t);return n?e==n.value:!1},function(t,n,r){var i=document.getElementById(n);return i?'The value should be the same as in <span class="'+e.vanadium.conf.message_value_class+'">'+(jQuery(i).attr("name")||i.id)+"</span> .":"There is no exemplar item!!!"},function(){return"ALL RIGHT !!!"},function(e){var t=document.getElementById(e.param);t&&(jQuery(t).unbind("on-validate.__internal"),jQuery(t).bind("on-validate.__internal",function(){jQuery(e.element).validate().decorate()}))}],["ajax",function(e,t,n,r){var i=function(e,t,n,i,s){r()};s(e)?r(!0):jQuery.ajax({url:t,data:{value:e,id:n.id},success:i,error:i})}],["format",function(e,t){var n=t.match(/^\/(((\\\/)|[^\/])*)\/(((\\\/)|[^\/])*)$/);if(!n||n.length!=7)return!1;var r=n[1],i=n[4];try{var s=new RegExp(r,i);return s.test(e)}catch(o){return!1}},function(t,n){var r=n.split("/");return r.length==3&&r[0]==""?'The value should match the <span class="'+e.vanadium.conf.message_value_class+'">'+n.toString()+"</span> pattern.":'provided parameter <span class="'+e.vanadium.conf.message_value_class+'">'+n.toString()+"</span> is not valid Regexp pattern."}]])}(jQuery),$(function(){var e=JSON.parse($('script[type="text/x-vanadiumjs-config"]').html()||"{}");$.vanadium.conf=$.extend($.vanadium.conf,e),$.vanadium.conf.enable_on_init&&$.vanadium.on(),$("input, textarea, select").live("blur",function(){$.vanadium.conf.default_validate_on_blur&&$(this).vanadium().validate().decorate()}),$("input, textarea, select").live("focus",function(){$(this).vanadium().reset().decorate()})})