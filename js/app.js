define("HandlebarsHelpers",["model"],function(e){return Handlebars.registerHelper("formatDate",function(e,t){return e?Date.parse(e).toString("d MMM yyyy"):t||""}),Handlebars.registerHelper("formatMoney",function(e){return(e||0).formatMoney()}),Handlebars.registerHelper("formatNumber",function(e,t,n,r){return(e||0).formatNumber(t,n,r)}),Handlebars.registerHelper("sector_icon",function(e){var t;return t=(_.find(e.tags,function(e){return e.type==="sector"})||{}).tag||"OTH","/img/sec_"+t+".png"}),Handlebars.registerHelper("stripes",function(e,t,n,r){var i,s,o,u;if((e!=null?e.length:void 0)>0){i="",s=0,u=e.length;while(s<u)o=e[s],o.stripeClass=s%2===0?t:n,i+=r.fn(o),s++;return i}return r.elseFn()}),Handlebars.registerHelper("higlighted_org",function(t){var n;return n=e.org_displaying(),n[t.id]?"highlighted":""}),Handlebars.registerHelper("groups",function(e,t,n,r,i){var s,o,u,a,f;o=0;if(e&&e.length>0){s="",u=0,f=e.length;while(u<f)a=e[u],o===0&&(s+=t),s+=i.fn(a),o+=1,o>r&&(s+=n,o=0),u++;return o>0&&(s+=n),s}return elseFn()}),Handlebars.registerHelper("tagsOfType",function(e,t,n){var r,i;return r="",i=_.filter(e,function(e){return e.type===t}),_.each(i,function(e){return r+=n.fn(e)}),r}),Handlebars.registerHelper("filtered",function(e,t,n,r,i){var s,o,u;return s="",o=_.filter(e,function(e){return e[n]===r}),u={},u[t]=o,o.length>0&&(s+=i.fn(u)),s})}),define("api",[],function(){var e,t,n,r;return t="scarypumpkin",e=function(e){var n,r;return e.cache=!0,e.beforeSend=function(e){return e.setRequestHeader("Cache-Control","max-age=600"),e.setRequestHeader("X-TechCityMap-ApiKey",t)},e.dataType="json",e.timeout=3e4,e.complete=function(){},r=$.Deferred(),n=$.ajax(e),n.done(function(e,t,n){return r.resolve(e.data)}),n.fail(function(e,t,n){return console.error(e,t,n,arguments)}),r},n=function(t,n){return e({url:t,data:n,dataType:"json"})},r=function(t,n){return e({url:t,data:n,type:"POST",dataType:"json"})},{get_company_by_id:function(e,t,r){var i;return i=n("/api/companies/"+e,null),$.when(i).done(function(e){return e.profile_image_url=e.profile_image_url||"/img/default_twitter_profile.png",t(e)})},search_org_by_name:function(e){return n("/api/companies/search?q="+e)},search_tags:function(e){return n("/api/tags/search?q="+e)}}}),define("charts",[],function(){return{rednder_revenue_overview:function(e){var t,n;return n=new Highcharts.Chart({chart:{renderTo:$("#revenue_overview .chart").get(0),type:"area",height:160},title:null,subtitle:null,legend:{enabled:!1},xAxis:{startOnTick:!0,categories:_.map(e.revenue_timeline,function(e){return Date.parse(e.accounts_date)}),labels:{formatter:function(){return Highcharts.dateFormat("%Y",this.value)}}},yAxis:{showFirstLabel:!1,title:null,labels:{formatter:function(){return"£"+Highcharts.numberFormat(this.value,0,",")}}},tooltip:{crosshairs:!0,formatter:function(){return"<div>Year "+this.x.getFullYear()+"</div><br/><div>"+"£"+Highcharts.numberFormat(this.y,0,",")+"</div>"},shared:!0},plotOptions:{area:{color:"#FE9900",lineWidth:5,fillOpacity:.5}},series:[{name:"Revenue",data:_.map(e.revenue_timeline,function(e){return e.revenue})}],credits:{enabled:!1}}),t=new Highcharts.Chart({chart:{renderTo:$("#employees_overview .chart").get(0),type:"area",height:150},title:null,subtitle:null,legend:{enabled:!1},xAxis:{startOnTick:!0,categories:_.map(e.revenue_timeline,function(e){return Date.parse(e.accounts_date)}),labels:{formatter:function(){return Highcharts.dateFormat("%Y",this.value)}}},yAxis:{showFirstLabel:!1,title:null,labels:{formatter:function(){return this.value}}},tooltip:{crosshairs:!0,formatter:function(){return"<div>Year "+this.x.getFullYear()+"</div><br/><div>"+this.y+"</div>"},shared:!0},plotOptions:{area:{color:"#AC2148",lineWidth:5,fillOpacity:.5}},series:[{name:"Employment",data:_.map(e.employee_count_timeline,function(e){return e.employee_count})}],credits:{enabled:!1}})}}}),define("force",["model","graph"],function(e,t){var n,r,i;return $("image.node-img").live("click",function(){return techcitymap.sammy.context.redirect("#/company/"+$(this).attr("data-org").replace("_",""))}),r=function(t){var n;n=e.egonet_companies_rank();if(n==="influence")return 15+5*t.influence;if(n==="mentions")return 15+5*t.is_mentioned_rank;if(n==="tweets")return 15+5*t.tweet_rank},n=function(t){var n;n=e.egonet_network_rank();if(n==="follow")return t.r_c===0?"#EE3387":"#009900";if(n==="mention")return t.r_c===0?"#EE3387":"#009900";if(n==="hashtag")return"#FF34CE";if(n==="shares_directors_with")return"#FF0000"},{render_egonet:function(e,t){var i,s,o,u,a,f,l,c,h,p,d,v;return p=function(t){var i,s,o,u;return _.each(h,function(e){return e.added=!1}),u=_.reduce(t,function(e,t){return h[t.l]&&!h[t.l].added&&(h[t.l].added=!0,e.push(h[t.l])),h[t.r]&&!h[t.r].added&&(h[t.r].added=!0,e.push(h[t.r])),e},[]),u.length===0&&(u=[h[e]]),a.nodes(u),a.links(t),i=d3.select("#twitter_networks .chart g.edges").selectAll("line.link").data(t,function(e){return e.l+"-"+e.r+"-"+e.type}),i.enter().append("svg:line").attr("class","link").style("stroke-width",function(e){return""+(2+e.weight)}).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),i.exit().remove(),o=d3.select("#twitter_networks .chart g.nodes").selectAll("g.node").data(u,function(e){return e.id}),o.select("image").attr("height",function(e){return e.root?32:r(e)}).attr("width",function(e){return e.root?32:r(e)}),s=o.enter().append("svg:g").attr("class",function(e){return e.root?"node root":"node"}).call(a.drag),s.append("svg:image").attr("xlink:href",function(e){return e.profile_image_url}).attr("height",function(e){return e.root?32:r(e)}).attr("width",function(e){return e.root?32:r(e)}).attr("class","node-img").attr("data-org",function(e){return"_"+e.id}),s.append("svg:text").attr("dy",function(e){return e.root?24:r(e)}).attr("dx",function(e){return e.root?16:r(e)*.5}).attr("text-anchor","middle").text(function(e){return e.name}),o.exit().remove(),a.on("tick",function(){var e,t,i;return t=$("#twitter_networks .chart").width()/2,i=$("#twitter_networks .chart").height()/2,e=d3.select("#twitter_networks .chart g.edges").selectAll("line.link"),u=d3.select("#twitter_networks .chart g.nodes").selectAll("g.node"),e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("stroke",function(e){return n(e)}),u.attr("transform",function(e){var t;return t=e.root?16:r(e)/2,"translate("+(e.x-t)+","+(e.y-t)+")"})}),a.start()},o=d3.scale.category20(),a=d3.layout.force().linkStrength(.5).charge(-800).friction(.4).linkDistance(100).nodes([]).links([]),d=d3.select("#twitter_networks .chart").append("svg:svg"),d.append("svg:g").attr("class","edges"),d.append("svg:g").attr("class","nodes"),d.append("svg:defs").append("svg:marker").attr("id","Triangle").attr("viewBox","0 0 20 20").attr("refX","30").attr("refY","5").attr("markerUnits","userSpaceOnUse").attr("markerWidth","20").attr("markerHeight","20").attr("orient","auto").append("svg:path").attr("d","M 0 3 L 15 5 L 0 7 z").attr("stroke-width",1),v=$("#twitter_networks .egonet").width(),f=$("#twitter_networks .egonet").height(),d.attr("width",v).attr("height",f),a.size([v,f]),h=_.reduce(t.nodes,function(e,t){return e[t.id]=t,e},{}),h[e].fixed=!0,h[e].root=!0,h[e].x=v/2,h[e].y=f/2,u=_(t.edges.follows).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.weight=e.weight||.5,e.type="follows_edges",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),c=_(t.edges.is_mentioned_by).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="mentions_edges",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),l=_(t.edges.hashtag).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="hashtag_relations",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),i=_(t.edges.shares_directors_with).chain().map(function(e){return e.source=h[e.l],e.target=h[e.r],e.type="shares_directors_with",e}).filter(function(e){return h[e.l]&&h[e.r]}).value(),s=ko.dependentObservable(function(){if(this.egonet_network_rank()==="follow")return u;if(this.egonet_network_rank()==="mention")return c;if(this.egonet_network_rank()==="hashtag")return l;if(this.egonet_network_rank()==="shares_directors_with")return i},techcity.model),p(s()),s.subscribe(function(e){return p(e)}),techcity.model.egonet_companies_rank.subscribe(function(){return p(s())}),$("#relation_type").buttonset()}},i=function(e,t){var n;return t=t||0,t===0?"/img/Single_lvl1_a_01.png":(n="1",t>500?n="5":t>101?n="4":t>16?n="3":t>6?n="2":n="1","/img/"+(e?"Multiple_lvl":"Single_lvl")+n+"_a_01.png")},{render_directors_network:function(e,s){var o,u,a,f,l,c,h,p;return u=d3.scale.category20(),a=d3.layout.force().linkStrength(.5).charge(-600).friction(.4).linkDistance(50).nodes([]).links([]),h=d3.select("#directors_network .chart").append("svg:svg"),h.append("svg:g").attr("class","edges"),h.append("svg:g").attr("class","nodes"),h.append("svg:defs").append("svg:marker").attr("id","Triangle").attr("viewBox","0 0 20 20").attr("refX","30").attr("refY","5").attr("markerUnits","userSpaceOnUse").attr("markerWidth","20").attr("markerHeight","20").attr("orient","auto").append("svg:path").attr("d","M 0 3 L 15 5 L 0 7 z").attr("stroke-width",1),p=$("#directors_network .egonet").width(),f=$("#directors_network .egonet").height(),h.attr("width",p).attr("height",f),a.size([f,f]),o=_(s.edges.shares_directors_with).chain().map(function(e){return e.source=t.orgs_by_id[e.l],e.target=t.orgs_by_id[e.r],e.type="shares_directors_with",e}).filter(function(e){return t.orgs_by_id[e.l]&&t.orgs_by_id[e.r]}).value(),l=_.reduce(o,function(e,n){return t.orgs_by_id[n.l]&&!t.orgs_by_id[n.l].added&&(t.orgs_by_id[n.l].added=!0,e.push(t.orgs_by_id[n.l])),t.orgs_by_id[n.r]&&!t.orgs_by_id[n.r].added&&(t.orgs_by_id[n.r].added=!0,e.push(t.orgs_by_id[n.r])),e},[]),c=function(e){var t,s,o,u;return _.each(l,function(e){return e.added=!1}),a.nodes(l),a.links(e),s=d3.select("#directors_network .chart g.edges").selectAll("line.link").data(e,function(e){return e.l+"-"+e.r+"-"+e.type}),s.enter().append("svg:line").attr("class","link").style("stroke-width",function(e){return""+(2+e.weight)}).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),s.exit().remove(),u=d3.select("#directors_network .chart g.nodes").selectAll("g.node").data(l,function(e){return e.id}),u.select("image").attr("height",function(e){return e.root?32:r(e)}).attr("width",function(e){return e.root?32:r(e)}),o=u.enter().append("svg:g").attr("class",function(e){return e.root?"node root":"node"}).call(a.drag),o.append("svg:image").attr("xlink:href",function(e){return i(!1,e.employee_count)}).attr("height",function(e){return e.root?32:r(e)}).attr("width",function(e){return e.root?32:r(e)}).attr("class","node-img").attr("data-org",function(e){return"_"+e.id}),o.append("svg:text").attr("dy",function(e){return e.root?42:r(e)*1.5}).attr("dx",function(e){return e.root?16:r(e)*.5}).attr("text-anchor","middle").text(function(e){return e.name.replace(/\s+$/,"").replace(/LIMITED$/,"LTD")}),t=o.append("svg:g").attr("style","visibility:hidden"),t.append("svg:rect").attr("rx",5).attr("ry",5).attr("width",100).attr("height",100).attr("style","fill:white;stroke:black;stroke-width:2;opacity:0.9"),t.append("svg:text").attr("text-anchor","middle").text("ala ma kota"),u.exit().remove(),a.on("tick",function(){var e,t,i;return t=$("#directors_network .chart").width()/2,i=$("#directors_network .chart").height()/2,e=d3.select("#directors_network .chart g.edges").selectAll("line.link"),l=d3.select("#directors_network .chart g.nodes").selectAll("g.node"),e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("stroke",function(e){return n(e)}),l.attr("transform",function(e){var t;return t=e.root?16:r(e)/2,"translate("+(e.x-t)+","+(e.y-t)+")"})}),a.start()},c(o)}}}),Number.prototype.formatNumber=function(e,t,n){var r,i,s,o;return s=this,e=isNaN(e=Math.abs(e))?2:e,t=t===void 0?".":t,n=n===void 0?",":n,o=s<0?"-":"",r=parseInt(s=Math.abs(+s||0).toFixed(e))+"",i=r.length,i=i>3?i%3:0,o+(i?r.substr(0,i)+n:"")+r.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(s-r).toFixed(e).slice(2):"")},Number.prototype.formatMoney=function(e){var t;return e=e||"£",t=this,t<=-1e12?"-"+e+(-t/1e12).formatNumber(1,".",",")+"tn":t<=-1e9?"-"+e+(-t/1e9).formatNumber(1,".",",")+"bn":t<=-1e6?"-"+e+(-t/1e6).formatNumber(1,".",",")+"m":t<=-1e3?"-"+e+(-t/1e3).formatNumber(1,".",",")+"k":t<0?"-"+e+t.formatNumber(2,".",","):t<1e3?e+t.formatNumber(2,".",","):t<1e6?e+(t/1e3).formatNumber(1,".",",")+"k":t<1e9?e+(t/1e6).formatNumber(1,".",",")+"m":t<1e12?e+(t/1e9).formatNumber(1,".",",")+"bn":e+(t/1e12).formatNumber(1,".",",")+"tn"};var margin_bottom,margin_top,relayout,throttled_relayout;margin_top=0,margin_bottom=0,relayout=function(){var e,t,n;if($("body").hasClass("map-view"))return e=$("body").height(),n=$(".sticky-header").height(),t=$(".sticky-footer").offset().top,$(".sticky-content").offset({top:n+margin_top,left:0}).css("bottom",e-t+margin_bottom)},throttled_relayout=_.throttle(relayout,50),$(function(){var e;return $(window).resize(throttled_relayout),$("body.map-view .sticky-footer").live("hover",function(){return $("body").scrollTop(1e5)}),$("body.map-view .sticky-footer").live("mouseleave",function(){return $("body").scrollTop(0)}),e=window.setInterval(throttled_relayout,1e3),relayout()}),function(e,t){var n;return n=e(t),e.fn.lazy=function(r){var i,s,o,u;return u=function(){var t;return t=0,s.each(function(){var n;n=e(this);if(!e.abovethetop(this,o)&&!e.leftofbegin(this,o)){if(!e.belowthefold(this,o)&&!e.rightoffold(this,o))return n.trigger("appear"),t=0;if(++t>o.failure_limit)return!1}})},s=this,i=void 0,o={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,appear:null,load:null},r&&(void 0!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),void 0!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),e.extend(o,r)),i=o.container===void 0||o.container===t?n:e(o.container),0===o.event.indexOf("scroll")&&i.bind(o.event,_.debounce(function(e){return u()},200)),this.each(function(){var t,n;n=this,t=e(n),n.loaded=!1,t.one("appear",function(){var t;if(!this.loaded&&!this.loading&&o.appear)return n.loading=!0,t=e.grep(s,function(e){return!e.loading}),s=e(t),o.appear.call(n)});if(0!==o.event.indexOf("scroll"))return t.bind(o.event,function(e){if(!n.loaded)return t.trigger("appear")})}),n.bind("resize",function(e){return u()}),e(document).ready(function(){return u()}),this},e.belowthefold=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.height()+n.scrollTop():s=e(i.container).offset().top+e(i.container).height(),s<=e(r).offset().top-i.threshold},e.rightoffold=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.width()+n.scrollLeft():s=e(i.container).offset().left+e(i.container).width(),s<=e(r).offset().left-i.threshold},e.abovethetop=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.scrollTop():s=e(i.container).offset().top,s>=e(r).offset().top+i.threshold+e(r).height()},e.leftofbegin=function(r,i){var s;return s=void 0,i.container===void 0||i.container===t?s=n.scrollLeft():s=e(i.container).offset().left,s>=e(r).offset().left+i.threshold+e(r).width()},e.inviewport=function(t,n){return!e.rightoffold(t,n)&&!e.leftofbegin(t,n)&&!e.belowthefold(t,n)&&!e.abovethetop(t,n)},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window),define("linkedin_api",["domready!"],function(){var e,t,n;return e=function(e){var t;return t=IN.User.isAuthorized(),t?$("body").addClass("in-authorised"):$("body").addClass("in-not-authorised"),e(IN)},n=0,t=function(){return n+=1,"__linkedin_api_req_"+n+"__"},{load:function(n,r,i,s){var o;return s.isBuild?i(null):(o=t(),window[o]=function(){return e(i)},$.getScript("http://platform.linkedin.com/in.js?async=true",function(){return IN.init({onLoad:o,api_key:"zhybt2bl2865",authorize:!0,scope:"r_basicprofile r_network"})}))}}}),define("linkedin",["text!/partials/linkedin-template.html","linkedin_api!","model"],function(e,t,n){var r,i;return r=Handlebars.compile(e),i={first_page:{},full:{},summary:{}},IN.User.isAuthorized()?n.linkedin_authorized(!0):n.linkedin_authorized(!1),IN.Event.on(IN,"auth",function(){return n.linkedin_authorized(!0)}),IN.Event.on(IN,"logout",function(){return n.linkedin_authorized(!1)}),$(".in_login").live("click",function(){return IN.User.authorize()}),$(".in_logout").live("click",function(){return IN.User.logout()}),{get_single_page_linkedin_contacts:function(e,t,n,r){var i,s;return i=$.Deferred(),s={sort:"distance","current-company":!0,start:t,count:n,"company-name":e},r&&(s.facet=r),IN.API.PeopleSearch().fields("id","firstName","lastName","headline","pictureUrl","publicProfileUrl","distance").params(s).result(function(e,t){return i.resolve(e)}).error(function(e){return i.reject(e)}),i},get_first_page_linkedin_contacts:function(e,t){if(!i.first_page[e]||i.first_page[e].state()==="rejected")i.first_page[e]=this.get_single_page_linkedin_contacts(e,0,t);return i.first_page[e]},get_all_linkedin_contacts:function(e){var t,n,r,s,o=this;s=Date.now().getTime(),console.log("a "+(Date.now().getTime()-s));if(!i.full[e]||i.full[e].state()==="rejected")t=$.Deferred(),i.full[e]=t,console.log("b "+(Date.now().getTime()-s)),n=this.get_first_page_linkedin_contacts(e,25),r=[n],console.log("c "+(Date.now().getTime()-s)),n.done(function(n){var i,u,a,f;f=n.people._total,i=n.people._count||0,a=Math.ceil((f-i)/25),u=0;while(u<a)r.push(o.get_single_page_linkedin_contacts(e,i+u*25,25)),u++;return console.log("linked in first "+(Date.now().getTime()-s)),$.when.apply(o,r).done(function(){var e;return e=_.chain(arguments).pluck("people").map(function(e){return e.values||[]}).flatten().map(function(e){return e.first=e.distance===1,e}).value(),console.log("linked in fetched "+_.size(e)+"contacts in "+(Date.now().getTime()-s)),t.resolve(e)}).fail(function(){return t.reject(arguments)})});return i.full[e]},render_linkedin_contacts:function(e){var t,n;return t=$.Deferred(),n=e.name,$("#company_view .linkedin-details").html(""),this.get_all_linkedin_contacts(n).done(function(e){var n;return n=r(e),$("#company_view .box.linkedin .content").html(n),t.resolve(!0)}),t},get_linkedin_summary:function(e){var t,n,r;if(!i.summary[e]||i.summary[e].state()==="rejected")t=$.Deferred(),i.summary[e]=t,n=this.get_single_page_linkedin_contacts(e,0,1,"network,F"),r=this.get_single_page_linkedin_contacts(e,0,1,"network,S"),$.when(n,r).done(function(e,n){return t.resolve({first_degree:e.numResults,second_degree:n.numResults})}).fail(function(){return t.reject(arguments)});return i.summary[e]},get_all_linkedin_data:function(e){var t,n,r;return r=Date.now().getTime(),console.log("a "+(Date.now().getTime()-r)),t=$.Deferred(),console.log("b "+(Date.now().getTime()-r)),n=[],_.each(e,function(e){return n.push(this.get_single_page_linkedin_contacts(e.name,0,1,"network,F")),n.push(this.get_single_page_linkedin_contacts(e.name,0,1,"network,S"))}),console.log("c "+(Date.now().getTime()-r)),$.when.apply(this,n).done(function(e,n,i,s,o,u){var a;return a=_.chain(arguments).pluck("people").map(function(e){return e.values}).flatten().value(),console.log("linked in fetched ALL"+_.size(a)+"contacts in "+(Date.now().getTime()-r)),t.resolve(a)}).fail(function(){return t.reject(arguments)}),t}}}),define("map",["maps_api","domready!"],function(e,t){var n,r,i;return n=new google.maps.LatLng(52.207607,.140848),i={zoom:14,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,draggableCursor:"pointer",noClear:!1,styles:[{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"},{weight:.5},{color:"#c0c0c0"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"},{weight:.3},{color:"#808080"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{visibility:"simplified"},{weight:1},{color:"#a0a0a0"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"},{weight:.3},{color:"#808080"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"},{weight:1},{color:"#ac2046"}]}]},r=new google.maps.Map(document.getElementById("map_canvas"),i),r}),define("maps_api",["google!maps,3.x,other_params:sensor=false"],function(){return window.google.maps}),define("model",["graph"],function(e){var t,n=this;return t={},t.focused_node=void 0,t.focused_org=void 0,t.title="Cambridge Cluster Map ",t.description=ko.observable(""),t.view=ko.observable("map"),t.links=ko.computed(function(){return t.view()==="map"||t.view()==="list"?t.view():"list"}),t.location=ko.observable(""),t.path_rest=ko.computed(function(){return _.tail(t.location().replace(/^\//,"").split("/")).join("/")}),t.path_rest_links=ko.computed(function(){var e;return e=t.location().replace(/^\//,"").split("/"),_.contains(["badge","sector","view"],_.head(e))?"/"+e.join("/"):""}),t.org_displaying=ko.observable(e.orgs_by_id),t.org_displaying_count=ko.computed(function(){return _.size(t.org_displaying()).formatNumber(0,".",",")}),t.org_displaying_employees=ko.computed(function(){return _.reduce(t.org_displaying(),function(e,t){return e+((t.do_not_aggregate?void 0:t.employee_count)||0)},0).formatNumber(0,".",",")}),t.org_displaying_revenue=ko.computed(function(){return _.reduce(t.org_displaying(),function(e,t){return e+((t.do_not_aggregate?void 0:t.last_revenue)||0)},0).formatMoney()}),t.total_count=ko.observable(_.size(e.orgs_by_id).formatNumber(0,".",",")),t.total_employees=ko.observable(_.reduce(e.orgs_by_id,function(e,t){return e+((t.do_not_aggregate?void 0:t.employee_count)||0)},0).formatNumber(0,".",",")),t.total_revenue=ko.observable(_.reduce(e.orgs_by_id,function(e,t){return e+((t.do_not_aggregate?void 0:t.last_revenue)||0)},0).formatMoney()),t.egonet_companies_rank=ko.observable("influence"),t.egonet_network_rank=ko.observable("mention"),t.showing_message=ko.computed(function(){return _.isEmpty(t.description())?"Showing: All companies":"Showing: "+t.description()}),t.linkedin_authorized=ko.observable(!1),t.linkedin_button_text=ko.computed(function(){return t.linkedin_authorized()?"Sign out":"Sign in"}),t.linkedin_state=ko.computed(function(){return t.linkedin_authorized()?"in_logout":"in_login"}),window.model=t,t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("BuildingMVC",["router","MarkerWithLabel","model","graph","map","maps_api"],function(e,t,n,r,i){var s;return s=function(e){function d(e,s){var f,l;this.node=e,l=new google.maps.LatLng(this.node.latitude,this.node.longitude),console.log(r),f=_.reduce(this.node.ids,function(e,t){return e+(r.orgs_by_id[t].employee_count||1)},0),this.marker=new t({position:l,icon:n(this.node.ids.length>1,f),node:this.node,clickable:!0,optimized:!1,zIndex:s,labelContent:u(this.node,r)||"",labelClass:"labels"}),this.revenueCircle=new google.maps.Circle({clickable:!1,fillColor:"#F2C674",fillOpacity:.2,strokeOpacity:0}),this.set("radius",a(this.node,r)),this.set("fillColor",o(this.node,r)),this.revenueCircle.bindTo("fillColor",this),this.revenueCircle.bindTo("center",this,"position"),this.revenueCircle.bindTo("radius",this),this.marker.bindTo("position",this),this.set("position",l),this.setMap(i,!1),this.node.building=this,this.node.marker=this.marker}var n,s,o,u,a,f,l,c,h,p;return __extends(d,e),d.prototype.refreshIcon=function(e,t){return this.set("icon",n(e,t))},d.prototype.refreshDisc=function(){return this.set("radius",a(this.node,r)),this.set("fillColor",o(this.node,r))},d.prototype.refreshLabel=function(){return this.marker.set("labelContent",u(this.node,r))},h=function(e,t){return d.prototype.displaying_orgs_by_node(e.ids,t)},p=new google.maps.MarkerImage("/img/Single_lvl1_a_01.png"),n=function(e,t){var n,r,i;return t===0?p:(i="1",t>500?i="5":t>101?i="4":t>16?i="3":t>6?i="2":i="1",n="/img/"+(e?"Multiple_lvl":"Single_lvl")+i+"_a_01.png",r=new google.maps.MarkerImage(n),r)},f=function(e){return(_.find(e.tags,function(e){return e.type==="diskcolor"})||{}).description||"gray"},l=function(e,t){return _.max(h(e,t),function(e){return e.last_revenue})||0},c=function(e,t){return _.reduce(h(e,t),function(e,t){return e+(t.last_revenue||1)},0)},o=function(e,t){var n;return n=l(e,t),f(n)},a=function(e,t){var n;return n=c(e,t),n<5e6?50:n<2e7?100:n<1e8?150:n<25e7?300:500},u=function(e,t){return l(e,t).name},s=function(e,t){return l(e,t)},d.prototype.setMap=function(e,t){return this.marker.setMap(e,t),this.revenueCircle.setMap(e)},d}(google.maps.MVCObject),s.prototype.displaying_orgs_by_node=function(e,t){var r;return r=n.org_displaying(),_.reduce(e,function(e,n){return r[n]&&e.push(t.orgs_by_id[n]),e},[])},s});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("CompanyMVC",["model","BuildingMVC","TooltipMVC","map","graph","text!/partials/hover-info.html","maps_api"],function(e,t,n,r,i,s){var o;return o=function(o){function h(t,r){var i=this;this.tooltipOverlay=new n(t,"hover_info"),this.set("map",t),_.each(r,function(e){return i.addNode(e)}),$("#hover_info .outer").live("mouseleave",function(){return l.handle("mouse_leave_tooltip",i)}),$("#hover_info .outer").live("mouseenter",function(){return l.handle("mouse_enter_tooltip",i)}),e.org_displaying.subscribe(function(e){return i.refreshIcons(e)})}var u,a,f,l,c;return __extends(h,o),h.prototype.refreshIcons=function(e){var t,n;return n=1,t=_.size(e),_.each(i.nodes,function(s){var o,u,a;return t>0?(u=_.reduce(s.ids,function(t,n){return e[n]?t+1:t},0),u>0?(s.building.setMap(r,t<60),o=_.reduce(s.ids,function(t,n){return e[n]&&(t+=i.orgs_by_id[n].employee_count||0),t},0),a=_.reduce(s.ids,function(t,n){return e[n]&&(t+=i.orgs_by_id[n].last_revenue||0),t},0),s.building.refreshIcon(u>1,o),s.building.refreshDisc(),s.building.refreshLabel(),s.marker.setZIndex(n++)):s.building.setMap(null)):s.building.setMap(null)})},h.prototype.resize=function(){return google.maps.event.trigger(this.get("map"),"resize")},f=Handlebars.compile(s),c=function(e){var t;return t=f(e),$("#hover_info .template").replaceWith(t)},a=function(e,t){var n,r,i,s,o;return r=function(){var t,r;return r=null,t=e.apply(s,n)},n=void 0,i=void 0,s=void 0,o=void 0,function(){var u;return u=_.head(arguments),n=_.tail(arguments),s=this,clearTimeout(o),u?i=e.apply(s,n):o=setTimeout(r,t),i}},u=null,l=new machina.Fsm({signal:function(){var e;return e=function(e,t,n){if(!t)return e.hide_tooltip(),u=null,console.log("off"),this.transition("off");if(n!==u)return e.show_tooltip(n.marker),u=n,console.log("on",n.ids),this.transition("on")},a(e,500)}(),initialState:"off",states:{on:{mouse_enter:function(e,t){if(t!==u)return console.log("on: mouse_enter",t.ids),this.signal(!1,e,!0,t)},mouse_click:function(e,t){if(t!==u)return console.log("on: mouse_click",t.ids),this.signal(!0,e,!0,t)},mouse_leave:function(e){return console.log("on: mouse_leave"),this.signal(!1,e,!1,u.ids)},mouse_enter_tooltip:function(e){return console.log("on: mouse_enters_tooltip",u.ids),this.signal(!0,e,!0,u)},mouse_leave_tooltip:function(e){return console.log("tooltip: mouse_leaves_tooltip",u.ids),this.signal(!1,e,!1,u)}},off:{mouse_enter:function(e,t){return console.log("off: mouse_enter",t.ids),this.signal(!0,e,!0,t)},mouse_click:function(e,t){return console.log("off: mouse_click",t.ids),this.signal(!0,e,!0,t)},mouse_leave:function(){},mouse_enter_tooltip:function(e){return console.error("it should never happen")},mouse_leave_tooltip:function(e){return console.error("it should never happen")}}}}),h.prototype.show_tooltip=function(e){var n,r,s;return r=e.node,n={},n.org=null,n.orgs=_.filter(t.prototype.displaying_orgs_by_node(r.ids,i),function(e){return!0}),c(n),s=this.tooltipOverlay.getProjection().fromLatLngToDivPixel(e.get("position")),$("#hover_info .outer").css("display","block").css("visibility","hidden"),$("#hover_info").css({left:s.x,top:s.y-$("#hover_info").height()-30}),$("#hover_info .outer").stop().css("visibility","visible").css("opacity","").fadeIn(400)},h.prototype.hide_tooltip=function(){return this.tooltipOverlay.div.find(".outer").css("visibility","hidden")},h.prototype.fadeout_tooltip=function(){return this.tooltipOverlay.div.find(".outer").stop().fadeOut(500)},h.prototype.click_marker=function(e){return l.handle("mouse_click",this,e.node)},h.prototype.enter_marker=function(e){return l.handle("mouse_enter",this,e.node)},h.prototype.leave_marker=function(){return l.handle("mouse_leave",this)},h.prototype.addNode=function(e,n){var r,i=this;return r=new t(e,n),google.maps.event.addListener(r.marker,"click",function(){return l.handle("mouse_click",i,r.marker.node)}),google.maps.event.addListener(r.marker,"mouseover",function(){return l.handle("mouse_enter",i,r.marker.node)}),google.maps.event.addListener(r.marker,"mouseout",function(){return l.handle("mouse_leave",i)}),e},h.prototype.showTooltipByOrgId=function(e,t,n){var r,s,o,u,a,l;a=i.orgs_by_id[t],u=i.nodes_by_org_id[t],o=u.marker,l=e.getProjection().fromLatLngToDivPixel(o.get("position")),e.div.find(".outer").css("display","block").css("visibility","hidden"),r={org:a},s=f(r),e.div.find(".template").replaceWith(s),e.div.find(".tweet").html(graph_model.tweets_by_org_id()[t]),e.div.css({left:l.x,top:l.y-e.div.height()-20}),e.div.find(".outer").stop().css("visibility","visible").css("opacity","").fadeIn(400);if(n)return n(a)},h.prototype.navigateToNodeByOrgId=function(e,t){var n=this;return this.showTooltipByOrgId(e,t,function(e){return n.get("map").panTo(new google.maps.LatLng(e.latitude,e.longitude))})},h.prototype.template_tooltip=function(e){var t;return t=f(e),$("#hover_info .template").replaceWith(t)},h}(google.maps.MVCObject)}),define("MarkerWithLabel",["maps_api"],function(){function e(e){this.marker_=e,this.labelHolderDiv_=document.createElement("div"),this.labelDiv_=document.createElement("div"),this.labelHolderDiv_.appendChild(this.labelDiv_),this.labelDiv_.style.cssText="position: relative; overflow: hidden;",this.eventDiv_=document.createElement("div"),this.eventDivInner_=document.createElement("div"),this.eventDiv_.appendChild(this.eventDivInner_),this.eventDivInner_.style.cssText="cursor:pointer;"+this.labelDiv_.style.cssText}function t(t){t=t||{},t.labelContent=t.labelContent||"",t.labelAnchor=t.labelAnchor||new google.maps.Point(0,0),t.labelClass=t.labelClass||"markerLabels",t.labelStyle=t.labelStyle||{},t.labelInBackground=t.labelInBackground||!1,typeof t.labelVisible=="undefined"&&(t.labelVisible=!0),google.maps.Marker.apply(this,arguments),this.label=new e(this)}return e.prototype=new google.maps.OverlayView,e.prototype.onAdd=function(){var e=this,t=!1,n=!1,r,i,s,o,u,a=function(e){e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()};this.getPanes().overlayImage.appendChild(this.labelHolderDiv_),this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_),this.listeners_=[google.maps.event.addDomListener(document,"mouseup",function(i){n&&(i.latLng=r,u=!0,google.maps.event.trigger(e.marker_,"label-dragend",i)),t=!1,google.maps.event.trigger(e.marker_,"label-mouseup",i)}),google.maps.event.addListener(e.marker_.getMap(),"mousemove",function(i){t&&e.marker_.getDraggable()&&(i.latLng=new google.maps.LatLng(i.latLng.lat()-s,i.latLng.lng()-o),r=i.latLng,n?google.maps.event.trigger(e.marker_,"label-drag",i):(s=i.latLng.lat()-e.marker_.getPosition().lat(),o=i.latLng.lng()-e.marker_.getPosition().lng(),google.maps.event.trigger(e.marker_,"label-dragstart",i)))}),google.maps.event.addDomListener(this.eventDivInner_,"mouseover",function(t){e.eventDivInner_.style.cursor="pointer",google.maps.event.trigger(e.marker_,"label-mouseover",t)}),google.maps.event.addDomListener(this.eventDivInner_,"mouseout",function(t){e.eventDivInner_.style.cursor=e.marker_.getCursor(),google.maps.event.trigger(e.marker_,"label-mouseout",t)}),google.maps.event.addDomListener(this.eventDivInner_,"click",function(t){u?u=!1:(a(t),google.maps.event.trigger(e.marker_,"label-click",t))}),google.maps.event.addDomListener(this.eventDivInner_,"dblclick",function(t){a(t),google.maps.event.trigger(e.marker_,"label-dblclick",t)}),google.maps.event.addDomListener(this.eventDivInner_,"mousedown",function(r){t=!0,n=!1,s=0,o=0,a(r),google.maps.event.trigger(e.marker_,"label-mousedown",r)}),google.maps.event.addListener(this.marker_,"dragstart",function(t){n=!0,i=e.marker_.getZIndex()}),google.maps.event.addListener(this.marker_,"drag",function(t){e.marker_.setPosition(t.latLng),e.marker_.setZIndex(1e6)}),google.maps.event.addListener(this.marker_,"dragend",function(t){n=!1,e.marker_.setZIndex(i)}),google.maps.event.addListener(this.marker_,"position_changed",function(){e.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){e.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){e.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){e.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){e.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){e.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){e.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){e.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){e.setStyles()})]},e.prototype.onRemove=function(){var e;this.labelHolderDiv_.parentNode.removeChild(this.labelHolderDiv_),this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(e=0;e<this.listeners_.length;e++)google.maps.event.removeListener(this.listeners_[e])},e.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},e.prototype.setContent=function(){var e=this.marker_.get("labelContent");typeof e.nodeType=="undefined"?(this.labelDiv_.innerHTML=e,this.eventDivInner_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.appendChild(e),e=e.cloneNode(!0),this.eventDivInner_.appendChild(e))},e.prototype.setTitle=function(){this.eventDivInner_.title=this.marker_.getTitle()||""},e.prototype.setStyles=function(){var e,t;this.labelDiv_.className=this.marker_.get("labelClass"),this.eventDivInner_.className="event_label "+this.labelDiv_.className,this.labelDiv_.style.cssText="",this.eventDiv_.style.cssText="",t=this.marker_.get("labelStyle");for(e in t)t.hasOwnProperty(e)&&(this.labelDiv_.style[e]=t[e],this.eventDiv_.style[e]=t[e]);this.setMandatoryStyles()},e.prototype.setMandatoryStyles=function(){this.labelHolderDiv_.style.position="absolute",this.labelDiv_.style.position="relative",this.labelDiv_.style.left="-50%",this.labelDiv_.style.overflow="hidden",typeof this.labelDiv_.style.opacity!="undefined"&&(this.labelDiv_.style.filter="alpha(opacity="+this.labelDiv_.style.opacity*100+")"),this.eventDiv_.style.position="absolute",this.eventDivInner_.style.position=this.labelDiv_.style.position,this.eventDivInner_.style.overflow=this.labelDiv_.style.overflow,this.eventDivInner_.style.left=this.labelDiv_.style.left,this.eventDivInner_.style.opacity=1,this.eventDivInner_.style.filter="alpha(opacity=1)",this.setAnchor(),this.setPosition(),this.setVisible()},e.prototype.setAnchor=function(){var e=this.marker_.get("labelAnchor");this.labelHolderDiv_.style.marginLeft=-e.x+"px",this.labelHolderDiv_.style.marginTop=-e.y+"px",this.eventDiv_.style.marginLeft=-e.x+"px",this.eventDiv_.style.marginTop=-e.y+"px"},e.prototype.setPosition=function(){var e=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());this.labelHolderDiv_.style.left=e.x+"px",this.labelHolderDiv_.style.top=e.y+"px",this.eventDiv_.style.left=this.labelHolderDiv_.style.left,this.eventDiv_.style.top=this.labelHolderDiv_.style.top},e.prototype.setZIndex=function(){var e=this.marker_.get("labelInBackground")?-1:1;typeof this.marker_.getZIndex()=="undefined"?(this.labelHolderDiv_.style.zIndex=parseInt(this.labelHolderDiv_.style.top,10)+e,this.labelDiv_.style.zIndex=parseInt(this.labelHolderDiv_.style.top,10)+e,this.eventDiv_.style.zIndex=this.labelHolderDiv_.style.zIndex):(this.labelHolderDiv_.style.zIndex=this.marker_.getZIndex(),this.labelDiv_.style.zIndex=this.marker_.getZIndex(),this.eventDiv_.style.zIndex=this.labelHolderDiv_.style.zIndex)},e.prototype.setVisible=function(){this.marker_.get("labelVisible")?this.labelHolderDiv_.style.display=this.marker_.getVisible()?"block":"none":this.labelHolderDiv_.style.display="none",this.eventDiv_.style.display=this.labelHolderDiv_.style.display},t.prototype=new google.maps.Marker,t.prototype.setMap=function(e,t){google.maps.Marker.prototype.setMap.apply(this,arguments),t===!1?this.label.setMap(null):this.label.setMap(e)},t.prototype.setLabelData=function(e,t){$(this.label.labelDiv_).data(e,t)},t.prototype.getLabelData=function(e){return $(this.label.labelDiv_).data(e)},t.prototype.hideLabel=function(){this.label.unbind("map"),this.label.set("map",null)},t.prototype.showLabel=function(){this.label.bindTo("map",this)},t.prototype.onAdd=function(){google.maps.Marker.prototype.onAdd.apply(this,arguments),console.log(this)},t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("TooltipMVC",["map"],function(e){var t;return t=function(e){function t(e,t){this.dom_id=t,this.set("map",e)}return __extends(t,e),t.prototype.onAdd=function(){var e;return this.div=$('<div id="'+this.dom_id+'" class="hover-info" style="z-index=9999">'+'<div class="outer" style="visibility:hidden;">'+'  <div class="arrow-bottom"></div>'+'  <div class="inner">'+'    <div class="arrow-top"></div>'+'    <div class="template"></div>'+"  </div>"+"</div>"+"</div>"),e=this.getPanes().overlayMouseTarget,e.appendChild(this.div.get(0)),{mouseleave:function(e){return this.div.find(".outer").mouseleave(e)},mouseenter:function(e){return this.div.find(".outer").mouseenter(e)}}},t.prototype.draw=function(){},t}(google.maps.OverlayView)}),define("graph",["json!/api/geohash"],function(e){var t,n,r,i;return r=e.data.companies,t=e.data.nodes,i=_.reduce(r,function(e,t){return e[t.id]=t,e},{}),n=_.reduce(t,function(e,t){return _.reduce(t.ids,function(e,n){return e[n]=t,e},e)},{}),{orgs:r,nodes:t,orgs_by_id:i,nodes_by_org_id:n}}),define("nodes",["json!/api/geohash","CompanyMVC","map","HandlebarsHelpers"],function(e,t,n){var r;return r=new t(n,e.data.nodes),$("#loading_view").hide(),$("#map_view").show()}),define("org_view",["charts","model","text!/partials/company_details.html","api","linkedin"],function(e,t,n,r,i){var s;return s=Handlebars.compile(n),{display_company_details:function(e,n,o){return r.get_company_by_id(e,function(r){var u,a;console.log("org_in_focus",r),$("#update-a-company-dialog form").reset().decorate(),$("#update-a-company-dialog form").get(0).reset(),$("#company_name_u").val(r.name),$("#company_contact_email_u").val(""),$("#company_twitter_screen_name_u").val(r.twitter_screen_name),$("#company_address_u").val(r.address),$("#company_postcode_u").val(r.postcode),$("#company_employee_count_u").val(r.employee_count||0),$("#verification_email_u").val(""),$("#company_natural_id_u").val(r.id),$("#company_web_url_u").val(r.web_url),$("#company_sector_u").val((_.find(r.tags,function(e){return e.type==="sector"})||{}).tag),$("#company_description_u").val(r.description),$("#company_member_camnetwork_u").attr("checked",_.any(r.tags,function(e){return e.type==="view"&&e.tag==="camnetwork"})?"checked":null),$("#company_cuequity_univenture_u").attr("checked",_.any(r.tags,function(e){return e.type==="cuequity"&&e.tag==="univenture"})?"checked":null),$("#company_member_onenucleus_u").attr("checked",_.any(r.tags,function(e){return e.type==="view"&&e.tag==="onenucleus"})?"checked":null),$("#company_warrant_u").attr("checked",null),$("#company_dissolved_u").attr("checked",null),r.badges=_.reduce(r.tags,function(e,t){return t.type==="badge"&&(e[t.tag]=!0),e},{}),r.sector=(_.find(r.tags,function(e){return e.type==="sector"})||{}).description||"",u=s(r),$("#company_view").html(u),$("#company_view .update-company a").data("org_id",e),r.badges.top50rev&&$(".company-details img.badge_rev").show(),r.badges.top50emp&&$(".company-details img.badge_emp").show(),r.badges.camenterprise&&$(".company-details img.badge_uni").show(),ko.applyBindings(t,document.getElementById("company_view")),$(".top-mentioned .body").collapsorz({minimum:20,showText:"more",hideText:"less",linkLocation:".top-shared-interest .header"}),$(".top-mentions .body").collapsorz({minimum:20,showText:"more",hideText:"less",linkLocation:".top-shared-interest .header"}),a=i.render_linkedin_contacts(r),a.done(function(){return $(".box.linkedin .content").collapsorz({minimum:5,showText:"more",hideText:"less"})}),$(".box.directors .content").collapsorz({minimum:5,showText:"more",hideText:"less"}),o(r);if(n)return n(e,r)})}}}),define("org_view_twitter",[],function(){return{display_twitts:function(e){return $(".wrapper .tweets .tab .body .tweet-list").remove(),$(".wrapper .tweets .tab .body").tweet({query:"@"+e,refresh_interval:15,join_text:"auto",avatar_size:26,count:6,auto_join_text_default:"",auto_join_text_ed:"",auto_join_text_ing:"",auto_join_text_reply:"",auto_join_text_url:"",loading_text:"loading tweets...",template:"<div class='c1'>{avatar}</div><div class='c2'>{time} {text}</div>"})}}}),define("orgs_table",["model","graph","linkedin"],function(e,t,n){var r,i,s;return jQuery.fn.dataTableExt.oSort["percent-asc"]=function(e,t){var n,r;return n=e.replace(/%/g,""),r=t.replace(/%/g,""),n=parseInt(n),r=parseInt(r),n-r},$.fn.dataTableExt.oSort["percent-desc"]=function(e,t){return-1*$.fn.dataTableExt.oSort["percent-asc"](e,t)},jQuery.extend(jQuery.fn.dataTableExt.oSort,{"data-value-pre":function(e){return parseFloat(e.match(/data-value=('|")(.*?)('|")/)[2])},"data-value-asc":function(e,t){return e<t?-1:e>t?1:0},"data-value-desc":function(e,t){return e<t?1:e>t?-1:0}}),$.fn.dataTableExtsErrMode="throw",s=$("#list_view table").dataTable({bFilter:!1,bAutoWidth:!1,aaData:[],aoColumns:[{bVisible:!1},{sWidth:"60px",bSortable:!1,sTitle:"Logo",sClass:"text-left",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<img class='logo' original='"+t+"' width='48' height='48'> "}},{sTitle:"Company",sClass:"name text-left",fnRender:function(e){var t;return t=e.aData[0],"<a href='/company/"+t+"'>"+e.aData[e.iDataColumn]+"</a>"}},{sTitle:"Connections",bSortable:!1,sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[0],n=e.aData[e.iDataColumn],"<span class='linkedin-org' data-org-name='"+n+"' data-org-id='"+t+"'>"+"<span class='linkedin-progress'></span>"+"<table style='display:none;'>"+"  <tr>"+"    <td>"+"       <span class='badge badge-linkedin'>1st</span>"+"    </td>"+"    <td>"+"      <span class='F'>12312312</span>"+"    </td>"+"  </tr>"+"  <tr>"+"    <td>"+"       <span class='badge badge-linkedin'>2nd</span>"+"    </td>"+"    <td>"+"      <span class='S'>12312312</span>"+"    </td>"+"  </tr>"+"</table>"+"</span>"}},{sTitle:"Badges",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn],n=(t.top50rev?8:0)+(t.top50emp?4:0)+(t.camenterprise?2:0)+(t.businessweekly?1:0),"<span data-value='"+n+"'>"+(t.top50rev?"<img src='/img/badge_rev.png' > ":"")+(t.top50emp?"<img src='/img/badge_emp.png' > ":"")+(t.camenterprise?"<img src='/img/badge_uni.png' > ":"")+(t.businessweekly?"<img src='/img/badge_bw.png' > ":"")+"</span>"}},{sTitle:"Sector",sWidth:"160px",sType:"string"},{bVisible:!1},{sTitle:"Revenue",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn],n=e.aData[e.iDataColumn-1],"<span data-value='"+t+"'>"+t.formatMoney()+" <span class='smaller'>("+n+")</span>"+"</span>"}},{sTitle:"Revenue<br/>Change",sWidth:"120px",sType:"data-value",sClass:"text-right",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<span data-value='"+t+"' class='"+(t>=0?"positive":"negative")+"'>"+t.formatMoney()+(t>=0?" ▲":" ▼")+"</span>"}},{bVisible:!1},{sTitle:"Employees",sType:"data-value",sWidth:"120px",fnRender:function(e){var t,n;return t=e.aData[e.iDataColumn]||0,n=e.aData[e.iDataColumn-1],"<span data-value='"+t+"'>"+t.formatNumber(0,".",",")+" <span class='smaller'>("+n+")</span>"+"</span>"}},{sTitle:"Employee<br/>Change",sWidth:"120px",sType:"data-value",sClass:"text-right",fnRender:function(e){var t;return t=e.aData[e.iDataColumn],"<span data-value='"+t+"' class='"+(t>=0?"positive":"negative")+"'>"+t.formatNumber(0,".",",")+(t>=0?" ▲":" ▼")+"</span>"}}],bLengthChange:!1,iDisplayLength:1e3,fnDrawCallback:function(){return $("#list_view").is(":visible")},oLanguage:{sZeroRecords:"... Loading ..."}}),r=_.map(e.org_displaying(),function(e){return[e.id,e.profile_image_url||"",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}),s.fnAddData(r),e.org_displaying.subscribe(function(e){return r=void 0,_.isEmpty(e)?r=_.map(t.companies,function(e){return[e.id,e.profile_image_url||"_",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}):r=_.map(e,function(e){return[e.id,e.profile_image_url||"_",e.name||"[NAME]",e.name||"[NAME]",function(){return _.chain(e.tags).filter(function(e){return e.type==="badge"}).reduce(function(e,t){return e[t.tag]=!0,e},{}).value()}(),function(){var t;return t=_.find(e.tags,function(e){return e.type==="sector"}),t?t.description:null}(),e.last_revenue_year,e.last_revenue||0,e.revenue_delta||0,e.last_revenue_year,e.employee_count,e.employee_count_delta||0]}),s.fnClearTable(),s.fnAddData(r)}),i=function(){return $("#list_view .linkedin-org").lazy({appear:function(e){var t,r;return r=$(this).data("orgName"),t=$(this),n.get_linkedin_summary(r).done(function(e){return t.find(".linkedin-progress").hide(),t.find(".F").text(e.first_degree),t.find(".S").text(e.second_degree),t.find("table").show()})}})},e.view.subscribe(function(e){if(e==="list")return s.fnAdjustColumnSizing(),i()}),e.org_displaying.subscribe(function(e){return i()})}),define("router",["json!/api/tags","api","org_view_twitter","charts","force","org_view","graph","model","linkedin","HandlebarsHelpers"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m=this;return h=new Sammy.Application(function(){var e;return this.debug=!0,this.use(Sammy.Handlebars,"hb"),e={}}),h.bind("location-changed",function(e,t,n){return u.location(h.getLocation())}),l=function(e){return s.display_company_details(e,function(e,t){return r.rednder_revenue_overview(t),n.display_twitts(t.screen_name)},function(t){return i.render_directors_network(e,t)})},d=_.reduce(o.orgs,function(e,t){return _.reduce(t.tags,function(e,t){return e[t.type]=e[t.type]||{},e[t.type][t.tag]=!0,e},e)},{}),p=function(){var e;return e=!0,function(t,n){var r;return $(".view").hide(),$("#loading_view").hide(),$("#map_view").show(),u.view("map"),google.maps.event.trigger(t,"resize"),e&&(r=new n(t,o.nodes),e=!1,t.panTo(new google.maps.LatLng(52.205,.122))),r.refreshIcons(u.org_displaying())}}(),$(".company-navi").live("click",function(e){return e.preventDefault(),h.setLocation("/company/"+$(this).data("id")),null}),h.get("/",function(){return require(["map","CompanyMVC"],function(e,t){var n;return $(window).scrollTop(0),document.title=u.title+" - "+"All companies",u.org_displaying(o.orgs_by_id),n="All companies",p(e,t)})}),h.get("/company/:id",function(){return document.title=u.title+" - "+"Company",$(".view").hide(),$("#loading_view").show(),l(this.params.id),u.view("org"),$("div.hover-info .outer").hide(),$(".sticky-content .view").hide(),$("#loading_view").hide(),$("#company_view").show()}),h.get("/on_map/:id",function(){var e;return require(["CompanyMVC"],function(e){}),$(window).scrollTop(0),document.title=u.title+" - "+"All companies",p(),u.description(""),e=this.params.id,u.focused_node=o.nodes_by_org_id[e],u.focused_org=o.orgs_by_id[e],mvc.navigateToNodeByOrgId(focusOverlay,e)}),h.get("/list",function(e){return require(["orgs_table"],function(e){return $(".view").hide(),$("#list_view").show(),u.org_displaying(o.orgs_by_id),u.view("list")})}),h.get("/about",function(e){return $(".view").hide()}),h.get("/your_browser_is_not_supported",function(e){return $(".view").hide(),$("#not-supported-browser-dialog").show(),_gaq.push(["_trackEvent","browser_unsupported"])}),_.each(d,function(t,n){var r;return r=_.keys(t).join("|"),h.get(new RegExp("/map/"+n+"/("+r+")$"),function(t){return require(["map","CompanyMVC"],function(r,i){var s,a,f;return f=t.params.splat[0]||!1,a=e[n+"/"+f]||{},u.description(a.description||""),_.isEmpty(a.ids)?s=o.orgs_by_id:s=_.reduce(a.ids,function(e,t){return e[t]=o.orgs_by_id[t],e},{}),u.org_displaying(s),$(window).scrollTop(0),document.title=u.title+" - "+u.description(),p(r,i)})})}),_.each(d,function(t,n){var r;return r=_.keys(t).join("|"),h.get(new RegExp("/list/"+n+"/("+r+")$"),function(t){var r,i,s;return s=t.params.splat[0]||!1,i=e[n+"/"+s]||{},u.description(i.description||""),_.isEmpty(i.ids)?r=o.orgs_by_id:r=_.reduce(i.ids,function(e,t){return e[t]=o.orgs_by_id[t],e},{}),u.org_displaying(r),require(["orgs_table"],function(e){return $(".view").hide(),$("#list_view").show(),u.view("list")})})}),h.get("",function(e){return e.redirect("/")}),h.before(function(e){var t;return t=h.routablePath(this.path).replace(/^\//,"").split("/")[0],$("body").attr("class",""),t!==""?$("body").addClass(t+"-view"):$("body").addClass("map-view")}),h.before(function(e){return $("#twitter_button").attr("src","http://platform.twitter.com/widgets/tweet_button.html?count=none&original_referer="+encodeURIComponent(location.href)+"&url="+encodeURIComponent(location.href)+"&text="+encodeURIComponent("Cambridge Cluster Map"))}),h.before(function(e){return _gaq.push(["_trackPageview",this.path])}),c=_.size(o.companies),f=_.reduce(o.companies,function(e,t){return e+(t.employee_count||0)},0),v=_.reduce(o.companies,function(e,t){return e+(t.last_revenue||0)},0),$("#count .result").text(c.formatNumber(0,".",",")),$("#employee_count .result").text(f.formatNumber(0,".",",")),$("#total_revenue .result").text(v.formatMoney()),$(".showing-bar .orgs .n").text(c.formatNumber(0,".",",")),$(".showing-bar .emp .n").text(f.formatNumber(0,".",",")),$(".showing-bar .rev .n").text(v.formatMoney()),ko.applyBindings(u),$("input.search").typeahead({source:function(e,n){return console.log(e),$.when(t.search_org_by_name(e),t.search_tags(e)).then(function(e,t){return n(e.concat(t))}),void 0},sorter:function(e){return e},matcher:function(){return!0},highlighter:function(e){return e.name?"<div>"+e.name+"</div>":"<div>"+e.description+" ("+e.count+")</div>"},updater:function(e){return e.type?h.setLocation("/"+u.view()+"/"+e.type+"/"+e.tag):(u.focused_node=void 0,u.focused_org=void 0,u.org_displaying(o.orgs_by_id),h.setLocation("/company/"+e.id))},minLength:3}),h._location_proxy.has_history?h.run():h.run("/#"),h}),function(e){function t(){this.lock=0}function n(t){return e(t).parent().size()>0}function r(t,n,r,i,s){var o=this;this.name=t,this.message=i,this.error_message=r,this.validationFunction=n,this.init=s||e.noop,e.extend(o,{test:function(e,t,n,r){var i=!1,s=function(e){i||(i=!0,r(e))},o=this.validationFunction.call(this,e,t,n,s);o!==undefined&&!i&&(i=!0,r&&r(o))},validMessage:function(){return this.message},invalidMessage:function(){return this.error_message},toString:function(){return"name:"+this.name+" message:"+this.message+" error_message:"+this.error_message}})}function i(n){var r=this,i=[],s={},o=undefined,u=e.vanadium.guid++,a=new t,f=!1;e.extend(r,{parse:function(){var t=e.vanadium.parse(n);return i=t[0],s=t[1],_.each(i,function(e){e.element=n}),r},validate:function(t){return this.parse(),o={},_.each(i,function(t){var i=e.vanadium.validator_types[t.name];i&&(i.init(t),(!o[i.name]||!i[i.name].success)&&i.test(n.val(),t.param,n.get(0),a.sync(function(a){f=!0;var l=a?i.message:i.error_message;e.isFunction(l)&&(l=l(n.val(),t.param,r));var c={success:a,name:i.name,advice_id:t.advice_id,message:l};o[i.name]=c;var h=t.advice_id||s.advice_id;if(h&&e("#"+h).size()==1){var p=e("#"+h);p.data("vanadium-elements")||p.data("vanadium-elements",{}),p.data("vanadium-elements")[u]||(p.data("vanadium-elements")[u]={}),p.data("vanadium-elements")[u][i.name]=c}f=!1})))}),n.trigger("on-validate"),r},decorate_advice:function(t){var n=t.data("vanadium-elements"),r=!0,i=e("<div>"+t.html()+"</div>");i.find("."+e.vanadium.conf.advice_class).remove();var s=[];n&&_.each(n,function(e){_.each(e,function(e){e.message&&s.push(e),r=r&&e.success})}),r?(t.addClass(e.vanadium.conf.valid_class),t.removeClass(e.vanadium.conf.invalid_class)):(t.removeClass(e.vanadium.conf.advice_class),t.removeClass(e.vanadium.conf.valid_class),t.addClass(e.vanadium.conf.invalid_class)),i.html().trim()!=""?r?t.hide():t.show():s.length==0?t.hide():(t.html(""),_.each(s,function(n){var r=e('<span class="'+e.vanadium.conf.advice_class+'"></span>').html(n.message);n.success?(r.addClass(e.vanadium.conf.valid_class),r.removeClass(e.vanadium.conf.invalid_class)):(r.removeClass(e.vanadium.conf.advice_class),r.removeClass(e.vanadium.conf.valid_class),r.addClass(e.vanadium.conf.invalid_class)),t.append(r)}),t.show())},decorate:a.sync(function(){o&&_.size(o)>0?_.some(_.values(o),function(e){return!e.success})?(n.removeClass(e.vanadium.conf.valid_class),n.addClass(e.vanadium.conf.invalid_class)):(n.addClass(e.vanadium.conf.valid_class),n.removeClass(e.vanadium.conf.invalid_class)):(n.removeClass(e.vanadium.conf.valid_class),n.removeClass(e.vanadium.conf.invalid_class)),_.each(i,function(t){var n=t.advice_id||s.advice_id;n&&e("#"+n).size()>0&&r.decorate_advice(e("#"+n))}),_.each(o,function(t){var n=t.advice_id||s.advice_id;n&&e("#"+n).size()>0&&r.decorate_advice(e("#"+n))});var t=e(n).parents(".\\"+e.vanadium.conf.prefix+e.vanadium.conf.container_class);return t.size()>0&&(t.data("vanadium-elements")||t.data("vanadium-elements",{}),t.data("vanadium-elements")[u]=this,t.each(function(){var t=e(this),n=_.some(t.data("vanadium-elements"),function(n,r){return n.element().parent().size()==0?(e(n.element()).removeData("vanadium-vanad"),n.element(undefined),delete t.data("vanadium-elements")[r],!1):_.some(n.validation_results(),function(e){return!e.success})});n?(e(this).removeClass(e.vanadium.conf.valid_class),e(this).addClass(e.vanadium.conf.invalid_class)):(e(this).addClass(e.vanadium.conf.valid_class),e(this).removeClass(e.vanadium.conf.invalid_class))})),n.trigger("on-decorate"),r}),reset_advice:function(e){var t=e.data("vanadium-elements");t&&delete t[u]},reset:function(){return _.each(o,function(t){t.advice_id&&e("#"+t.advice_id).size()>0&&r.reset_advice(e("#"+t.advice_id))}),o=undefined,n.trigger("on-reset"),r},uid:function(){return u},validation_results:function(){return o},element:function(e){var t=n;return arguments.length>0&&(n=e),t},valid:function(){return n.get(0).tagName=="FORM"?_.reduce(n.find("input, textarea, select"),function(t,n){return t&&!_.some(e(n).vanadium().validation_results()||[],function(e){return!e.success})},!0):o?!_.some(o,function(e){return!e.success}):!0}})}function s(e){return e==null||e.length==0}t.prototype.sync=function(e,t,n){var r=function(e){return!!e&&toString.call(e)==="[object Function]"},i=this;return function(){var s=this,o=Array.prototype.slice.call(arguments);(function u(){var a=i.lock++;a>0&&console&&console.debug&&console.debug("mutex lock: "+a);if(a!=0)setTimeout(u,1);else try{var f=e.apply(s,o);r(t)&&t.call(s,f)}catch(l){r(n)?n.call(s,l):console.error&&console.error(l)}finally{i.lock=0}})()}},e.vanadium={mutex:new t,version:"2.0",compatible_with_jquery:"1.4.2",conf:{prefix:":",separator:";",valid_class:"vanadium-valid",advice_class:"vanadium-advice",invalid_class:"vanadium-invalid",message_value_class:"vanadium-value",container_class:"container",language:"EN"},validator_types:{},guid:0,addValidatorType:function(t,n,i,s,o){e.vanadium.validator_types[t]=new r(t,n,i,s,o)},addValidatorTypes:function(t){var n=this;_.each(t,function(t){e.vanadium.addValidatorType.apply(n,t)})},on:function(){e("form").live("submit.vanadium",function(t){t.preventDefault();try{var n=e(this).find("input, textarea, chackbox, select");e.each(n,function(){e(this).vanadium().validate().decorate()})}catch(r){console.log(r)}})},off:function(){e("form").die(".vanadium")},parse_markup:function(t){if(t.indexOf(e.vanadium.conf.prefix)==0){var n=t.substr(e.vanadium.conf.prefix.length).split(e.vanadium.conf.separator);for(var r in n)n[r]==""&&(n[r]=undefined);return n}return undefined},validation_instance:function(e){var t=e[0];if(t!="only_on_blur"&&t!="only_on_submit"&&t!="wait"&&t!="advice"){var n=e[1],r=e[2];return{name:t,param:n,advice_id:r}}return undefined},validation_modifier:function(e){var t=e[0],n=e[1];if(t=="only_on_blur"||t=="only_on_submit")return{m_name:!0};if(t=="wait"){var r=parseInt(n);if(r!=NaN&&typeof r=="number")return{wait:r}}else if(t=="advice")return{advice_id:n};return undefined},parse:function(t){var n=e(t),r=[],i={},s;return n.attr("data-vanadium")?s=n.attr("data-vanadium").split(" "):n.attr("class")&&(s=n.attr("class").split(" ")),s&&_.each(s,function(t){var n=e.vanadium.parse_markup(t);n&&(r.push(e.vanadium.validation_instance(n)),e.extend(i,e.vanadium.validation_modifier(n)))}),[_.filter(r,function(e){return e}),i]}},e.fn.vanadium=function(){var t=e(this),n=t.data("vanadium-vanad");return n||(n=new i(t),e(t).data("vanadium-vanad",n)),n},e.fn.valid=function(){var t=e(this);return t.get(0).tagName=="INPUT"||t.get(0).tagName=="TEXTAREA"||t.get(0).tagName=="SELECT"?t.vanadium().valid():_.reduce(t.find("input, textarea, select"),function(t,n){return e(n).valid()||(t=t&&!1),t},!0)},e.fn.validate=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).validate()}):t.vanadium().validate()})},e.fn.decorate=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).decorate()}):t.vanadium().decorate()})},e.fn.reset=function(){return this.each(function(){var t=e(this);this.tagName=="FORM"?_.each(t.find("input, textarea, select"),function(t){e(t).reset()}):t.vanadium().reset()})},e().jquery.indexOf(e.vanadium.compatible_with_jquery)!=0&&window.console&&window.console.warn&&console.warn("This version of Vanadium is tested with jQuery "+e.vanadium.compatible_with_jquery+" it may not work as expected with this version ("+e().jquery+")"),e.vanadium.addValidatorType("empty",s),e.vanadium.addValidatorTypes([["equal",function(e,t){return e==t},function(t,n){return'The value should be equal to <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span>."}],["equal_ignore_case",function(e,t){return e.toLowerCase()==t.toLowerCase()},function(t,n){return'The value should be equal to <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span>."}],["required",function(e){return!s(e)},"This is a required field."],["accept",function(e,t,n){return n.checked},"Must be accepted!"],["integer",function(e){if(s(e))return!0;var t=parseFloat(e);return!isNaN(t)&&t.toString()==e&&Math.round(t)==t},"Please enter a valid integer in this field."],["number",function(e){return s(e)||!isNaN(e)&&!/^\s+$/.test(e)},"Please enter a valid number in this field."],["float",function(e){return s(e)||!isNaN(e)&&!/^\s+$/.test(e)},"Please enter a valid number in this field."],["digits",function(e){return s(e)||!/[^\d]/.test(e)},"Please use numbers only in this field. please avoid spaces or other characters such as dots or commas."],["alpha",function(e){return s(e)||/^[a-zA-Z\u00C0-\u00FF\u0100-\u017E\u0391-\u03D6]+$/.test(e)},"Please use letters only in this field."],["asciialpha",function(e){return s(e)||/^[a-zA-Z]+$/.test(e)},"Please use ASCII letters only (a-z) in this field."],["alphanum",function(e){return s(e)||!/\W/.test(e)},"Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed."],["date",function(e){var t=new Date(e);return s(e)||!isNaN(t)},"Please enter a valid date."],["email",function(e){return s(e)||/[\w\.]{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(e)},"Please enter a valid email address. For example fred@domain.com ."],["url",function(e){return s(e)||/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(e)},"Please enter a valid URL."],["date_au",function(e){if(s(e))return!0;var t=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!t.test(e))return!1;var n=new Date(e.replace(t,"$2/$1/$3"));return parseInt(RegExp.$2,10)==1+n.getMonth()&&parseInt(RegExp.$1,10)==n.getDate()&&parseInt(RegExp.$3,10)==n.getFullYear()},"Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006."],["currency_dollar",function(e){return s(e)||/^\$?\-?([1-9]{1}[0-9]{0,2}(,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(e)},"Please enter a valid $ amount. For example $100.00 ."],["selection",function(e,t,n){return elm.options?elm.selectedIndex>0:!s(e)},"Please make a selection"],["one_required",function(t,n,r){var i=jQuery('input[name="'+elm.name+'"]');return _.some(i,function(t){return e(t).value()})},"Please select one of the above options."],["length",function(e,t){return t===undefined?!0:e.length==parseInt(t)},function(t,n){return'The value should be <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["min_length",function(e,t){return t===undefined?!0:e.length>=parseInt(t)},function(t,n){return'The value should be at least <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["max_length",function(e,t){return t===undefined?!0:e.length<=parseInt(t)},function(t,n){return'The value should be at most <span class="'+e.vanadium.conf.message_value_class+'">'+n+"</span> characters long."}],["same_as",function(e,t){if(t===undefined)return!0;var n=document.getElementById(t);return n?e==n.value:!1},function(t,n,r){var i=document.getElementById(n);return i?'The value should be the same as in <span class="'+e.vanadium.conf.message_value_class+'">'+(jQuery(i).attr("name")||i.id)+"</span> .":"There is no exemplar item!!!"},function(){return"ALL RIGHT !!!"},function(e){var t=document.getElementById(e.param);t&&(jQuery(t).unbind("on-validate.__internal"),jQuery(t).bind("on-validate.__internal",function(){jQuery(e.element).validate().decorate()}))}],["ajax",function(e,t,n,r){var i=function(e,t,n,i,s){r()};s(e)?r(!0):jQuery.ajax({url:t,data:{value:e,id:n.id},success:i,error:i})}],["format",function(e,t){var n=t.match(/^\/(((\\\/)|[^\/])*)\/(((\\\/)|[^\/])*)$/);if(!n||n.length!=7)return!1;var r=n[1],i=n[4];try{var s=new RegExp(r,i);return s.test(e)}catch(o){return!1}},function(t,n){var r=n.split("/");return r.length==3&&r[0]==""?'The value should match the <span class="'+e.vanadium.conf.message_value_class+'">'+n.toString()+"</span> pattern.":'provided parameter <span class="'+e.vanadium.conf.message_value_class+'">'+n.toString()+"</span> is not valid Regexp pattern."}]])}(jQuery),$(function(){var e=JSON.parse($('script[type="text/x-vanadiumjs-config"]').html()||"{}");$.vanadium.conf=$.extend($.vanadium.conf,e),$.vanadium.conf.enable_on_init&&$.vanadium.on(),$("input, textarea, select").live("blur",function(){$.vanadium.conf.default_validate_on_blur&&$(this).vanadium().validate().decorate()}),$("input, textarea, select").live("focus",function(){$(this).vanadium().reset().decorate()})})